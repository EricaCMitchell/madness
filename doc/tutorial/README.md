# MADNESS tutorial

## Table of contents

1. [Downloading](#downloading)
1. [Building and installing](#building-and-installing)
1. Insanity
1. [MADNESS parallel runtime --- basic concepts and architecture](#MADNESS-parallel-runtime)
1. [MADNESS numerical API and example application](#MADNESS-numerical-API)
1. [MADNESS chemical API and example Hartree-Fock program](#MADNESS-chemical-API)

This tutorial covers
* using the MADNESS chemistry applications. [Florian, Hannes, Adrian]
  - structure of the input file
  - moldft, gradient
  - molresponse
  - all the other codes incl. 6D
  - excited states, hessian
* running MADNESS applications in parallel using threads + MPI [Hannes]; and
  - basic concepts
  - environment variables
  - single process
  - MPI
  - Tips, tricks, and pitfalls
    - binding process+threads to sockets
    - avoid fast malloc libraries if using MPI
* an overview of the MADNESS parallel runtime sufficient to develop numerical applications; [RJH]
* developing new applications using the numerical and chemistry APIS; [All of us]
  - overview of basic concepts and the numerical API [RJH]
  - cmake file and makefile to use madness as a library [???]
  - hello world in the numerical API [RJH]
  - overview of the chemistry API [Florian]
  - a simple Hartree-Fock program
  
## Downloading

From the command line, clone the [MADNESS GitHub repository](https://github.com/m-a-d-n-e-s-s/madness) using one of the below
* HTTPS
```
    git clone https://github.com/m-a-d-n-e-s-s/madness.git
```
* SSH (for which you will need to have a GitHub account with SSH key)
```
    git clone git@github.com:m-a-d-n-e-s-s/madness.git
```
This will make a new directory `madness` --- if you wish use a different name, append it to the command.

The head of the master branch usually builds and runs correctly due to the continuous integration.  If you are looking for the version tested for the Tromso June 2023 workshop, after cloning 
```
cd madness
checkout XXXXXXXXXXXXXXXXXXX
```

## Building and installing

Please refer to the [installation instructions](https://madness.readthedocs.io/en/latest/INSTALL.html).

Minimal recipe without MPI
```
mkdir build # CANNOT be in the madness source tree
cd build
cmake -DENABLE_MPI=OFF -DCMAKE_INSTALL_PREFIX=/home/me/madinstall /path/to/madness/source
make applications
make install  # optional
```

Issues that need fixing
* ACML is now AOCL
* Configuring a vanilla Intel Mac
  - what packages to install and how
* Configuring a vanilla ARM Mac
  - what packages to install and how

## MADNESS parallel runtime

Please refer to slides 166-189 in [MADNESSeverything4.pdf](https://github.com/m-a-d-n-e-s-s/madness/blob/tutorial/doc/MADNESSeverything4.pdf).
* Since the file is large, it is probably easier to look at your local version using your system PDF viewer

Hello world in MADNESS (runtime only --- numerical library is discussed below)
```
    #include <madness/world/MADworld.h>
    using namespace madness;

    int main(int argc, char** argv) {
        initialize(argc,argv);
        World world(SafeMPI::COMM_WORLD);

        print("Hello from processor",world.rank());

        finalize();
        return 0;
    }
```

## MADNESS numerical API

Please refer to the [Numerical Library User Documentation](https://madness.readthedocs.io/en/latest/numerical_library.html) for a worked example.

* Setup up your project files 
  * Make a new directory (`test`) with two new sub-directories `src` and `build`
    * `mkdir test`
    * `cd test`
    * `mkdir src build`
  * Copy and paste the example cmake code into `src/CMakeLists.txt`
  * Copy and paste the example C++ into `src/main.cc`
* Setup your environment so cmake can find MADNES
  * `export MADNESS_DIR=/path/to/madness/install/directory/`
* Build the code
  * `cd build`
  * `cmake ../src`
  * `make`
* Execute
  * `MAD_NUM_THREADS=2 ./yourbinary`
  
[Developer documentation](https://m-a-d-n-e-s-s.github.io/madness/api-doc/) generated by doxygen
* Needs extensive updating and will (eventually) be mostly superseded by readthedocs


## MADNESS chemical API

And we're off to the races



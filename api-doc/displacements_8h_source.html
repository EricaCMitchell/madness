<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MADNESS: displacements.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MADNESS<span id="projectnumber">&#160;0.10.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6b18f4c94988b4c3175a7db89843d784.html">madness</a></li><li class="navelem"><a class="el" href="dir_57953ffc297296ee8cc53983d0978021.html">mra</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">displacements.h</div></div>
</div><!--header-->
<div class="contents">
<a href="displacements_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">  This file is part of MADNESS.</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"></span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">  Copyright (C) 2007,2010 Oak Ridge National Laboratory</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"></span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">  This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">  the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">  (at your option) any later version.</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"></span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">  This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">  GNU General Public License for more details.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"></span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">  along with this program; if not, write to the Free Software</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"></span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">  For more information please contact:</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment"></span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">  Robert J. Harrison</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">  Oak Ridge National Laboratory</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">  One Bethel Valley Road</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">  P.O. Box 2008, MS-6367</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment"></span> </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment">  email: harrisonrj@ornl.gov</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">  tel:   865-241-3937</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">  fax:   865-572-0680</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment"></span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">  $Id$</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">*/</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#ifndef MADNESS_MRA_DISPLACEMENTS_H__INCLUDED</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#define MADNESS_MRA_DISPLACEMENTS_H__INCLUDED</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;<a class="code" href="indexit_8h.html">madness/mra/indexit.h</a>&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;<a class="code" href="funcdefaults_8h.html">madness/mra/funcdefaults.h</a>&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacemadness.html">madness</a> {<span class="comment"></span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">    /// Holds displacements for applying operators to avoid replicating for all operators</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment"></span>    <span class="keyword">template</span> &lt;std::<span class="keywordtype">size_t</span> NDIM&gt;</div>
<div class="foldopen" id="foldopen00051" data-start="{" data-end="};">
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html">   51</a></span>    <span class="keyword">class </span><a class="code hl_class" href="classmadness_1_1Displacements.html">Displacements</a> {</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">   53</a></span>        <span class="keyword">static</span> std::vector&lt; Key&lt;NDIM&gt; &gt; <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>; <span class="comment">///&lt; standard displacements to be used with standard kernels (range-unrestricted, no lattice sum)</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">   54</a></span>        <span class="keyword">static</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a> <a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>;  <span class="comment">///&lt; along which axes lattice summation is performed?</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">   55</a></span>        <span class="keyword">static</span> std::vector&lt; Key&lt;NDIM&gt; &gt; <a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[64];  <span class="comment">///&lt; displacements to be used with lattice-summed kernels</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen00058" data-start="{" data-end="}">
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#aa0ea990f0768c70bef4516a7b9e1b970">   58</a></span>        <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="classmadness_1_1Displacements.html#aa0ea990f0768c70bef4516a7b9e1b970">bmax_default</a>() {</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>            <span class="keywordtype">int</span> bmax;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>            <span class="keywordflow">if</span>      (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 1) bmax = 7;</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 2) bmax = 5;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 3) bmax = 3;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 4) bmax = 3;</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 5) bmax = 3;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 6) bmax = 3;</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            <span class="keywordflow">else</span>                bmax = 2;</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>            <span class="keywordflow">return</span> bmax;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>        }</div>
</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="keyword">private</span>:</div>
<div class="foldopen" id="foldopen00071" data-start="{" data-end="}">
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a2756cf4821f39f10624ba267ec042a1d">   71</a></span>        <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classmadness_1_1Displacements.html#a2756cf4821f39f10624ba267ec042a1d">cmp_keys</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>, <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>) {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>.distsq() &lt; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>.distsq();</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        }</div>
</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="foldopen" id="foldopen00075" data-start="{" data-end="}">
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#acca9ca50075802eab9592e6d58863859">   75</a></span>        <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classmadness_1_1Displacements.html#acca9ca50075802eab9592e6d58863859">cmp_keys_periodic</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>, <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>) {</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>.distsq_bc(<a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>) &lt; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>.distsq_bc(<a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>);</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        }</div>
</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="foldopen" id="foldopen00079" data-start="{" data-end="}">
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a5d59442277b92cbfb2423b79bcc576b4">   79</a></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classmadness_1_1Displacements.html#a5d59442277b92cbfb2423b79bcc576b4">make_disp</a>(<span class="keywordtype">int</span> bmax) {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="comment">// Note newer loop structure in make_disp_periodic_sum</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;Translation,NDIM&gt;</a> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>(0);</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <span class="keywordtype">int</span> num = 1;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            <span class="keywordflow">for</span> (std::size_t i=0; i&lt;<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++i) num *= (2*bmax + 1);</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>.resize(num,<a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0));</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            num = 0;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 1) {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0])</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                    <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>[num++] = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            }</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 2) {</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0])</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                    <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1])</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                        <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>[num++] = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            }</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 3) {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0])</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                    <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1])</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                        <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2])</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                            <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>[num++] = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            }</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 4) {</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0])</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                    <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1])</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                        <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2])</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                            <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3])</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                                <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>[num++] = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>            }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 5) {</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0])</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                    <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1])</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                        <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2])</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                            <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3])</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[4]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[4]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[4])</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                                    <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>[num++] = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>            }</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> == 6) {</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[0])</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                    <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[1])</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                        <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[2])</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                            <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[3])</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                                <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[4]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[4]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[4])</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>                                    <span class="keywordflow">for</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[5]=-bmax; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[5]&lt;=bmax; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[5])</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>                                        <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>[num++] = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(0,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            }</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>                <a class="code hl_define" href="madness__exception_8h.html#a629efc935073cf10318bc5bf759ad8f3">MADNESS_EXCEPTION</a>(<span class="stringliteral">&quot;make_disp: hard dimension loop&quot;</span>,<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>);</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            }</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>            std::sort(<a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>.begin(), <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>.end(), <a class="code hl_function" href="classmadness_1_1Displacements.html#a2756cf4821f39f10624ba267ec042a1d">cmp_keys</a>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        }</div>
</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="foldopen" id="foldopen00135" data-start="{" data-end="}">
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a9803d533f65eb7f3a3755af1ed5bbdca">  135</a></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classmadness_1_1Displacements.html#a9803d533f65eb7f3a3755af1ed5bbdca">make_disp_periodic</a>(<span class="keywordtype">int</span> bmax, <a class="code hl_typedef" href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">Level</a> n) {</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>            <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(<a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>.<a class="code hl_function" href="classmadness_1_1array__of__bools.html#a0678b3aefb6c7ea0c88042f8a269eb28">any</a>());  <span class="comment">// else use make_disp</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>            <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> twon = <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a>(1)&lt;&lt;n;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            <span class="keywordflow">if</span> (bmax &gt; (twon-1)) bmax=twon-1;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>            <span class="comment">// Make permissible 1D translations, periodic and nonperiodic (for mixed BC)</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> bp[4*bmax+1];</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> bnp[2*bmax+1];</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>            <span class="keywordtype">int</span> ip=0;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>            <span class="keywordtype">int</span> inp=0;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>            <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> lx=-bmax; lx&lt;=bmax; ++lx) {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                bp[ip++] = lx;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                <span class="keywordflow">if</span> ((lx &lt; 0) &amp;&amp; (lx+twon &gt; bmax)) bp[ip++] = lx + twon;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                <span class="keywordflow">if</span> ((lx &gt; 0) &amp;&amp; (lx-twon &lt;-bmax)) bp[ip++] = lx - twon;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                bnp[inp++] = lx;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            }</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>            <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(ip &lt;= 4*bmax+1);</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(inp &lt;= 2*bmax+1);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> nbp = ip;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> nbnp = inp;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>            <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic push)</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>            <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic ignored <span class="stringliteral">&quot;-Wundefined-var-template&quot;</span>)</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>            <a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[n] = std::vector&lt; Key&lt;NDIM&gt; &gt;();</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;long,NDIM&gt;</a> lim;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i!=<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++i) {</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>              lim[i] = <a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>[i] ? nbp : nbnp;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>            }</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            <span class="keywordflow">for</span> (<a class="code hl_class" href="classmadness_1_1IndexIterator.html">IndexIterator</a> index(lim); index; ++index) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;Translation,NDIM&gt;</a> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                <span class="keywordflow">for</span> (std::size_t i=0; i&lt;<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++i) {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                  <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>[i] = <a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>[i] ? bp[index[i]] : bnp[index[i]];</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                }</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                <a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[n].push_back(<a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>(n,<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>));</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>            }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>            std::sort(<a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[n].begin(), <a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[n].end(), <a class="code hl_function" href="classmadness_1_1Displacements.html#acca9ca50075802eab9592e6d58863859">cmp_keys_periodic</a>);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">//             print(&quot;KEYS AT LEVEL&quot;, n);</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><span class="comment">//             print(disp_periodic[n]);</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic <a class="code hl_function" href="namespacemadness.html#a8fbd6434ef0ac76d2fc0b586d28b49fa">pop</a>)</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        }</div>
</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">        /// first time this is called displacements are generated.</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="comment">        /// if boundary conditions are not periodic, the periodic displacements</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="comment">        /// are generated for all axes. This allows to support application of</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">        /// operators with boundary conditions periodic along any axis (including all).</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">        /// If need to use periodic boundary conditions</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">        /// for some axes only, make sure to set the boundary conditions appropriately</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment">        /// before the first call to this</span></div>
<div class="foldopen" id="foldopen00190" data-start="{" data-end="}">
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#ae533d430ebd1daf7c014ba148cb846f9">  190</a></span><span class="comment"></span>        <a class="code hl_function" href="classmadness_1_1Displacements.html#ae533d430ebd1daf7c014ba148cb846f9">Displacements</a>() {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic push)</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic ignored <span class="stringliteral">&quot;-Wundefined-var-template&quot;</span>)</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span> </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>.empty()) {</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                <a class="code hl_function" href="classmadness_1_1Displacements.html#a5d59442277b92cbfb2423b79bcc576b4">make_disp</a>(<a class="code hl_function" href="classmadness_1_1Displacements.html#aa0ea990f0768c70bef4516a7b9e1b970">bmax_default</a>());</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>          }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>          <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> &lt;= 3) {</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[0].empty()) {  <span class="comment">// if not initialized yet</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>              <span class="keywordflow">if</span> (<a class="code hl_class" href="classmadness_1_1FunctionDefaults.html">FunctionDefaults&lt;NDIM&gt;::get_bc</a>().is_periodic().any())</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                <a class="code hl_function" href="classmadness_1_1Displacements.html#a581c99bfa05134a91e438c7b9e2633bd">reset_periodic_axes</a>(</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                    <a class="code hl_class" href="classmadness_1_1FunctionDefaults.html">FunctionDefaults&lt;NDIM&gt;::get_bc</a>().is_periodic());</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>              <span class="keywordflow">else</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                <a class="code hl_function" href="classmadness_1_1Displacements.html#a581c99bfa05134a91e438c7b9e2633bd">reset_periodic_axes</a>(<a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>{<span class="keyword">true</span>});</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            }</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>          }</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span> </div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic <a class="code hl_function" href="namespacemadness.html#a8fbd6434ef0ac76d2fc0b586d28b49fa">pop</a>)</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>        }</div>
</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="foldopen" id="foldopen00211" data-start="{" data-end="}">
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a31a2302044cd8c5c2fe1f746fc24cf74">  211</a></span>        <span class="keyword">const</span> std::vector&lt; Key&lt;NDIM&gt; &gt;&amp; <a class="code hl_function" href="classmadness_1_1Displacements.html#a31a2302044cd8c5c2fe1f746fc24cf74">get_disp</a>(<a class="code hl_typedef" href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">Level</a> n,</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                                                 <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>&amp; kernel_lattice_sum_axes) {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic push)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic ignored <span class="stringliteral">&quot;-Wundefined-var-template&quot;</span>)</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            <span class="keywordflow">if</span> (kernel_lattice_sum_axes.<a class="code hl_function" href="classmadness_1_1array__of__bools.html#a0678b3aefb6c7ea0c88042f8a269eb28">any</a>()) {</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>                <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> &lt;= 3);</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>                <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(n &lt; std::extent_v&lt;<span class="keyword">decltype</span>(<a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>)&gt;);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                <span class="keywordflow">if</span> ((kernel_lattice_sum_axes &amp;&amp; <a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>) != kernel_lattice_sum_axes) {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                  std::string msg =</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                      <span class="stringliteral">&quot;Displacements&lt;&quot;</span> + std::to_string(<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>) +</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                      <span class="stringliteral">&quot;&gt;::get_disp(level, kernel_lattice_sum_axes): kernel_lattice_sum_axes is set for some axes that were not periodic in the FunctionDefault&#39;s boundary conditions active at the time when Displacements were initialized; invoke Displacements&lt;NDIM&gt;::reset_periodic_axes(kernel_lattice_sum_axes) to rebuild the periodic displacements&quot;</span>;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                  <a class="code hl_define" href="madness__exception_8h.html#a629efc935073cf10318bc5bf759ad8f3">MADNESS_EXCEPTION</a>(msg.c_str(), 1);</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                }</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">disp_periodic</a>[n];</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic <a class="code hl_function" href="namespacemadness.html#a8fbd6434ef0ac76d2fc0b586d28b49fa">pop</a>)</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        }</div>
</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment"></span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="comment">        /// return the standard displacements appropriate for operators w/o lattice summation</span></div>
<div class="foldopen" id="foldopen00235" data-start="{" data-end="}">
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a2e774ca7f8de28edc1763bc07ea00cf1">  235</a></span><span class="comment"></span>        <span class="keyword">const</span> std::vector&lt; Key&lt;NDIM&gt; &gt;&amp; <a class="code hl_function" href="classmadness_1_1Displacements.html#a2e774ca7f8de28edc1763bc07ea00cf1">get_disp</a>() {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic push)</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic ignored <span class="stringliteral">&quot;-Wundefined-var-template&quot;</span>)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">disp</a>;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic <a class="code hl_function" href="namespacemadness.html#a8fbd6434ef0ac76d2fc0b586d28b49fa">pop</a>)</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        }</div>
</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span><span class="comment"></span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="comment">        /// rebuilds periodic displacements so that they are optimal for the given set of periodic axes</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span><span class="comment">        /// this must be done while no references to prior periodic displacements are outstanding (i.e. no operator application</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="comment">        /// tasks in flight)</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="comment">        /// \param new_periodic_axes the new periodic axes</span></div>
<div class="foldopen" id="foldopen00249" data-start="{" data-end="}">
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno"><a class="line" href="classmadness_1_1Displacements.html#a581c99bfa05134a91e438c7b9e2633bd">  249</a></span><span class="comment"></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classmadness_1_1Displacements.html#a581c99bfa05134a91e438c7b9e2633bd">reset_periodic_axes</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>&amp; new_periodic_axes) {</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic push)</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic ignored <span class="stringliteral">&quot;-Wundefined-var-template&quot;</span>)</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>          <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(new_periodic_axes.<a class="code hl_function" href="classmadness_1_1array__of__bools.html#a0678b3aefb6c7ea0c88042f8a269eb28">any</a>());  <span class="comment">// else why call this?</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>          <span class="keywordflow">if</span> (new_periodic_axes != <a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a>) {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            <a class="code hl_variable" href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">periodic_axes</a> = new_periodic_axes;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            <a class="code hl_typedef" href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">Level</a> nmax = 8 * <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a>) - 2;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            <span class="keywordflow">for</span> (<a class="code hl_typedef" href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">Level</a> n = 0; n &lt; nmax; ++n)</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>              <a class="code hl_function" href="classmadness_1_1Displacements.html#a9803d533f65eb7f3a3755af1ed5bbdca">make_disp_periodic</a>(<a class="code hl_function" href="classmadness_1_1Displacements.html#aa0ea990f0768c70bef4516a7b9e1b970">bmax_default</a>(), n);</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>          }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>          <a class="code hl_define" href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a>(diagnostic <a class="code hl_function" href="namespacemadness.html#a8fbd6434ef0ac76d2fc0b586d28b49fa">pop</a>)</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        }</div>
</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    };</div>
</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    <span class="keyword">template</span> &lt;std::<span class="keywordtype">size_t</span> N, std::<span class="keywordtype">size_t</span> M&gt;</div>
<div class="foldopen" id="foldopen00266" data-start="{" data-end="}">
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno"><a class="line" href="namespacemadness.html#abd36a25686e60712d4bb7c2714a9aeaf">  266</a></span>    <span class="keyword">constexpr</span> std::enable_if_t&lt;N&gt;=M, std::array&lt;std::size_t, <a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>-M&gt;&gt; <a class="code hl_function" href="namespacemadness.html#abd36a25686e60712d4bb7c2714a9aeaf">iota_array</a>(std::array&lt;std::size_t, M&gt; values_to_skip_sorted) {</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>      std::array&lt;std::size_t, <a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a> - M&gt; result;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>      <span class="keywordflow">if</span> <span class="keyword">constexpr</span> (<a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a> != M) {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        std::size_t nadded = 0;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        <span class="keyword">auto</span> value_to_skip_it = values_to_skip_sorted.begin();</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        assert(*value_to_skip_it &lt; <a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        <span class="keyword">auto</span> value_to_skip = *value_to_skip_it;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>        <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; <a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>; ++i) {</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>          <span class="keywordflow">if</span> (i &lt; value_to_skip) {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>            result[nadded++] = i;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value_to_skip_it != values_to_skip_sorted.end()) {</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>            ++value_to_skip_it;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            <span class="keywordflow">if</span> (value_to_skip_it != values_to_skip_sorted.end()) {</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>              value_to_skip = *value_to_skip_it;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            } <span class="keywordflow">else</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>              value_to_skip = <a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>          }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>        }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      }</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    }</div>
</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="comment"></span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="comment">    /**</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="comment">     * Generates points at the finite-thickness surface of an N-dimensional box [C1-L1,C1+L1]x...x[CN-LN,CN+LN] centered at point {C1,...CN} in Z^N.</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="comment">     * For finite thickness T={T1,...,TN} point {x1,...,xN} is at the surface face perpendicular to axis i xi&gt;=Ci-Li-Ti and xi&lt;=Ci-Li+Ti OR xi&gt;=Ci+Li-Ti and xi&lt;=Ci+Li+Ti.</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="comment">     * For dimensions with unlimited size the point coordinates are limited to [0,2^n], with n being the level of the box.</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="comment">     */</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="keyword">template</span>&lt;std::<span class="keywordtype">size_t</span> NDIM&gt;</div>
<div class="foldopen" id="foldopen00294" data-start="{" data-end="};">
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html">  294</a></span>    <span class="keyword">class </span><a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange.html">BoxSurfaceDisplacementRange</a> {</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keyword">public</span>:</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">  296</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a> = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae0d4fbcf82c2b46e2f76442269cdb439">  297</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae0d4fbcf82c2b46e2f76442269cdb439">PointPattern</a> = <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;std::optional&lt;Translation&gt;</a>, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abd18dadf37895989f0f79bd4ee1d2742">  298</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abd18dadf37895989f0f79bd4ee1d2742">Displacement</a> = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>;<span class="comment"></span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="comment">      /// this callable filters out points and/or displacements; note that the displacement is optional (this use case supports filtering based on point pattern onlu) and non-const to make it possible for the filter function to update the displacement (e.g. to map it back to the simulation cell)</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab6435a1abf1285d86a132355a21cf2b1">  300</a></span><span class="comment"></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab6435a1abf1285d86a132355a21cf2b1">Filter</a> = std::function&lt;bool(<a class="code hl_typedef" href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">Level</a>, <span class="keyword">const</span> <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae0d4fbcf82c2b46e2f76442269cdb439">PointPattern</a>&amp;, std::optional&lt;Displacement&gt;&amp;)&gt;;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keyword">private</span>:</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6864417be97a5f585ee963405e36ba11">  303</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6864417be97a5f585ee963405e36ba11">BoxRadius</a> = std::array&lt;std::optional&lt;Translation&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;;  <span class="comment">// null radius = unlimited size</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1ee1f7f39983c5f123b08e99e136c97c">  304</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1ee1f7f39983c5f123b08e99e136c97c">SurfaceThickness</a> = std::array&lt;std::optional&lt;Translation&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;;  <span class="comment">// null thickness for dimensions with null radius</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae9704b369fbb4145eaf4a87330004300">  305</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae9704b369fbb4145eaf4a87330004300">Box</a> = std::array&lt;std::pair&lt;Translation, Translation&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abdf1b732c29959b1578ef683a76b3e65">  306</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abdf1b732c29959b1578ef683a76b3e65">Hollowness</a> = std::array&lt;bool, NDIM&gt;;  <span class="comment">// this can be uninitialized, unlike array_of_bools</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8c7f80ff06523e4e4757e0330fde23aa">  307</a></span>      <span class="keyword">using </span><a class="code hl_class" href="classmadness_1_1array__of__bools.html">Periodicity</a> = <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">  309</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>;                          <span class="comment">///&lt; Center point of the box</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">  310</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6864417be97a5f585ee963405e36ba11">BoxRadius</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>;                  <span class="comment">///&lt; halved size of the box in each dimension</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1ee1f7f39983c5f123b08e99e136c97c">SurfaceThickness</a></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">  312</a></span>          <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>;    <span class="comment">///&lt; surface thickness in each dimension</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">  313</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae9704b369fbb4145eaf4a87330004300">Box</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>;                  <span class="comment">///&lt; box bounds in each dimension</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">  314</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abdf1b732c29959b1578ef683a76b3e65">Hollowness</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">hollowness_</a>;    <span class="comment">///&lt; does box contain non-surface points along each dimension?</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab10286f5727fb4dd404c54275c0b9f7f">  315</a></span>      <a class="code hl_class" href="classmadness_1_1array__of__bools.html">Periodicity</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab10286f5727fb4dd404c54275c0b9f7f">is_periodic_</a>;  <span class="comment">///&lt; which dimensions are periodic?</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">  316</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab6435a1abf1285d86a132355a21cf2b1">Filter</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">filter_</a>;  <span class="comment">///&lt; optional filter function</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a0704fdd77a49e835157ac0a88a4fb30f">  317</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abd18dadf37895989f0f79bd4ee1d2742">Displacement</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a0704fdd77a49e835157ac0a88a4fb30f">probing_displacement_</a>;  <span class="comment">///&lt; displacement to a nearby point on the surface; it may not be able to pass the filter, but is sufficiently representative of the surface displacements to allow screening with isotropic kernels</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment"></span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment">     * @brief Iterator class for lazy generation of surface points</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="comment">     *</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span><span class="comment">     * This iterator generates surface points on-demand by tracking the current fixed</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="comment">     * dimension and positions in each dimension. It implements the InputIterator concept.</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span><span class="comment">       */</span></div>
<div class="foldopen" id="foldopen00325" data-start="{" data-end="};">
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">  325</a></span>      <span class="keyword">class </span><a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a> {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      <span class="keyword">public</span>:</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a984b9e1c834b2174ba476bcefacb7065">  327</a></span>        <span class="keyword">enum</span> <a class="code hl_enumeration" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876">Type</a> {<a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a984b9e1c834b2174ba476bcefacb7065">Begin</a>, <a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9">End</a>};</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>      <span class="keyword">private</span>:</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">  329</a></span>        <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange.html">BoxSurfaceDisplacementRange</a>* <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>;  <span class="comment">///&lt; Pointer to parent box</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">  330</a></span>        <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>;                                <span class="comment">///&lt; Current point</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">  331</a></span>        <span class="keyword">mutable</span> std::optional&lt;Displacement&gt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a>;   <span class="comment">///&lt; Memoized displacement from parent-&gt;center_ to point, computed by displacement(), reset by advance()</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">  332</a></span>        <span class="keywordtype">size_t</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>;                           <span class="comment">///&lt; Current fixed dimension (i.e. faces perpendicular to this axis are being iterated over)</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">  333</a></span>        <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae9704b369fbb4145eaf4a87330004300">Box</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">box</a>;                                    <span class="comment">///&lt; updated box bounds in each dimension, used to avoid duplicate displacements by excluding the surface displacements for each processed fixed dim</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">  334</a></span>        <span class="keywordtype">bool</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">done</a>;                                  <span class="comment">///&lt; Flag indicating iteration completion</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        <span class="comment">// return true if we have another surface layer</span></div>
<div class="foldopen" id="foldopen00337" data-start="{" data-end="}">
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a85ed23aae700e21ce894cdec5f8e2efa">  337</a></span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a85ed23aae700e21ce894cdec5f8e2efa">next_surface_layer</a>() {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>          <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;Translation, NDIM&gt;</a> l = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.translation();</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>          <span class="keywordflow">if</span> (l[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] !=</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].second +</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>                  <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].value_or(0)) {</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>            <span class="comment">// if box is hollow along this dim (has 2 surface layers) and exhausted all layers on the &quot;negative&quot; side of the fixed dimension, move to the first layer on the &quot;positive&quot; side</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">hollowness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] &amp;&amp;</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                l[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] ==</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                    <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].first +</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                        <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].value_or(0)) {</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>              l[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] =</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                  <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].second -</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                  <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].value_or(0);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            } <span class="keywordflow">else</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>              ++l[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>];</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a> = <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.level(), l);</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>          } <span class="keywordflow">else</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        };</div>
</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span><span class="comment"></span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span><span class="comment">         * @brief Advances the iterator to the next surface point</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span><span class="comment">         *</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="comment">         * This function implements the logic for traversing the box surface by:</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span><span class="comment">         * 1. Incrementing displacement in non-fixed dimensions</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="comment">         * 2. Switching sides in the fixed dimension when needed</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="comment">         * 3. Moving to the next fixed dimension when current one is exhausted</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00366" data-start="{" data-end="}">
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#af20c8fbd45bb15f3a6177edc5a23f27d">  366</a></span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#af20c8fbd45bb15f3a6177edc5a23f27d">advance</a>() {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>          <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a>.reset();</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>          <span class="keyword">auto</span> increment_along_dim = [<span class="keyword">this</span>](<span class="keywordtype">size_t</span> dim) {</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>            <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(dim != <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>);</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>            <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;Translation, NDIM&gt;</a> unit_displacement(0); unit_displacement[dim] = 1;</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a> = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.neighbor(unit_displacement);</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>          };</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>          <span class="keywordflow">for</span> (int64_t i = <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> - 1; i &gt;= 0; --i) {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>            <span class="keywordflow">if</span> (i == <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>[i] &lt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">box</a>[i].second) {</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>              increment_along_dim(i);</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>              <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>            }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>            <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9658b78a4d05dba0823d3b5078e24a69">reset_along_dim</a>(i);</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>          }</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>          <span class="comment">// move to the next surface layer normal to the fixed dimension</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>          <span class="keywordflow">while</span> (<span class="keywordtype">bool</span> have_another_surface_layer = <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a85ed23aae700e21ce894cdec5f8e2efa">next_surface_layer</a>()) {</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>            <span class="keyword">const</span> <span class="keyword">auto</span> filtered_out = [&amp;,<span class="keyword">this</span>]() {</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>              <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>              <span class="keyword">const</span> <span class="keyword">auto</span>&amp; filter = this-&gt;parent-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">filter_</a>;</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>              <span class="keywordflow">if</span> (filter) {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae0d4fbcf82c2b46e2f76442269cdb439">PointPattern</a> point_pattern;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                point_pattern[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>];</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                std::optional&lt;Displacement&gt; nulldisp;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                result = !filter(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.level(), point_pattern, nulldisp);</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>              }</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>              <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            };</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            <span class="keywordflow">if</span> (!filtered_out())</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>              <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>          }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>          <span class="comment">// ready to switch to next fixed dimension with finite radius</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>          <span class="comment">// but first update box bounds to exclude the surface displacements for the current fixed dimension</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>          <span class="comment">// WARNING if box along this dimension is not hollow we are done!</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">hollowness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>]) {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">box</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] = {</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].first +</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                    <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].value_or(0) + 1,</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>                <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].second -</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>                    <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>].value_or(0) - 1};</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>          }</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>          <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">done</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>          }</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>          <span class="comment">// onto next dimension</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>          ++<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>          <span class="keywordflow">while</span> (!<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] &amp;&amp; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a> &lt; <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>) {</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>            ++<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>          }</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a> &gt;= <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">done</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>          }</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>          <span class="comment">// reset upon moving to the next fixed dimension</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++i) {</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>            <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9658b78a4d05dba0823d3b5078e24a69">reset_along_dim</a>(i);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>          }</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        }</div>
</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="foldopen" id="foldopen00435" data-start="{" data-end="}">
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aa1bd486595fd933abc26de1c97326bed">  435</a></span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aa1bd486595fd933abc26de1c97326bed">advance_till_valid</a>() {</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">filter_</a>) {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>            <span class="keyword">const</span> <span class="keyword">auto</span> filtered_out = [&amp;]() -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>              this-&gt;<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a20194a2b4ec5c95cafe21682f247434c">displacement</a>(); <span class="comment">// ensure disp is up to date</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>              <span class="keywordflow">return</span> !parent-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">filter_</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.level(), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.translation(), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a>);</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>            };</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>            <span class="comment">// if displacement has value, filter has already been applied to it, just advance it</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">done</a> &amp;&amp; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a>) this-&gt;<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#af20c8fbd45bb15f3a6177edc5a23f27d">advance</a>();</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>            <span class="keywordflow">while</span> (!done &amp;&amp; filtered_out()) {</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>              this-&gt;<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#af20c8fbd45bb15f3a6177edc5a23f27d">advance</a>();</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>            }</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>          }</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>          <span class="keywordflow">else</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>            this-&gt;<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#af20c8fbd45bb15f3a6177edc5a23f27d">advance</a>();</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        }</div>
</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="foldopen" id="foldopen00453" data-start="{" data-end="}">
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9658b78a4d05dba0823d3b5078e24a69">  453</a></span>        <span class="keywordtype">void</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9658b78a4d05dba0823d3b5078e24a69">reset_along_dim</a>(<span class="keywordtype">size_t</span> dim) {</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>          <span class="keyword">const</span> <span class="keyword">auto</span> is_fixed_dim = dim == <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>          <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;Translation, NDIM&gt;</a> l = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.translation();</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>          <span class="comment">// for fixed dimension start with first surface layer, else use box lower bound (N.B. it&#39;s updated as fixed dimensions change)</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>          <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> l_dim_min =</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>              is_fixed_dim</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                  ? <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[dim].first -</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>                        <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[dim].value_or(0)</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>              : <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">box</a>[dim].first;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>          <span class="comment">// if dimension is periodic, only include *unique* displacements (modulo period)</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab10286f5727fb4dd404c54275c0b9f7f">is_periodic_</a>[dim]) {</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>            <span class="keyword">const</span> <span class="keyword">auto</span> period = 1 &lt;&lt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>.level();</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> l_dim_max =</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>                is_fixed_dim ? <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[dim].second +</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>                          <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[dim].value_or(0) :</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>                 <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">box</a>[dim].second;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            l_dim_min = std::max(l_dim_min, l_dim_max - period + 1);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>            <span class="comment">// fixed dim only: l_dim_min may not correspond to a surface layer</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>            <span class="comment">// this can only happen if l_dim_min is in the gap between the surface layers</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>            <span class="keywordflow">if</span> (is_fixed_dim &amp;&amp; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">hollowness_</a>[dim]) {</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>              <span class="keywordflow">if</span> (l_dim_min &gt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[dim].first +</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                                  <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[dim].value_or(0)) {</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                l_dim_min = std::max(</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                    l_dim_min, <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[dim].second -</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                                   <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[dim].value_or(0));</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>              }</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>            }</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>          }</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>          l[dim] = l_dim_min;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>          <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a> = <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.level(), l);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>          <span class="comment">// if the entire surface layer is filtered out, pick the next one</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>          <span class="keywordflow">if</span> (dim == <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>) {</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>            <span class="keyword">const</span> <span class="keyword">auto</span> filtered_out = [&amp;,<span class="keyword">this</span>]() {</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>              <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>              <span class="keyword">const</span> <span class="keyword">auto</span>&amp; filter = this-&gt;parent-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">filter_</a>;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>              <span class="keywordflow">if</span> (filter) {</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae0d4fbcf82c2b46e2f76442269cdb439">PointPattern</a> point_pattern;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                point_pattern[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>];</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                std::optional&lt;Displacement&gt; nulldisp;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                result = !filter(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>.level(), point_pattern, nulldisp);</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>              }</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>              <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>            };</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>            <span class="keywordflow">if</span> (filtered_out()) {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>              <span class="keywordtype">bool</span> have_another_surface_layer;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>              <span class="keywordflow">while</span> ((have_another_surface_layer = <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a85ed23aae700e21ce894cdec5f8e2efa">next_surface_layer</a>())) {</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>                <span class="keywordflow">if</span> (!filtered_out())</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                  <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>              }</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>              <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(have_another_surface_layer);</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>            }</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>          }</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>        };</div>
</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="comment"></span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment">         * @return displacement from the center to the current point</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00515" data-start="{" data-end="}">
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a20194a2b4ec5c95cafe21682f247434c">  515</a></span>        <span class="keyword">const</span> std::optional&lt;Displacement&gt;&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a20194a2b4ec5c95cafe21682f247434c">displacement</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>          <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a>) {</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a> = <a class="code hl_function" href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">madness::displacement</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>, <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>);</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>          }</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">disp</a>;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        }</div>
</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span> </div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>      <span class="keyword">public</span>:</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        <span class="comment">// Iterator type definitions for STL compatibility</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7d7fe3107ddf0a35e525fa1158098ff1">  524</a></span>        <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7d7fe3107ddf0a35e525fa1158098ff1">iterator_category</a> = std::input_iterator_tag;</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9066b9d139a99175d87f1de4ccefaab6">  525</a></span>        <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9066b9d139a99175d87f1de4ccefaab6">value_type</a> = <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a>;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7a8b3875d4063f32e95343cd5629d246">  526</a></span>        <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7a8b3875d4063f32e95343cd5629d246">difference_type</a> = std::ptrdiff_t;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39b2564e247a4a6f4ebc4db709cc2c18">  527</a></span>        <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39b2564e247a4a6f4ebc4db709cc2c18">pointer</a> = <span class="keyword">const</span> <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a>*;</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aea15ac3cf4c0ff806346c6a87d898915">  528</a></span>        <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aea15ac3cf4c0ff806346c6a87d898915">reference</a> = <span class="keyword">const</span> <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">Point</a>&amp;;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment"></span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span><span class="comment">         * @brief Constructs an iterator</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="comment">         *</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment">         * @param p Pointer to the parent BoxSurfaceDisplacementRange</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="comment">         * @param type the type of iterator (Begin or End)</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00536" data-start="{" data-end="}">
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0837865ff3452b67186011c41e465fbc">  536</a></span>        <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0837865ff3452b67186011c41e465fbc">Iterator</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange.html">BoxSurfaceDisplacementRange</a>* <a class="code hl_function" href="derivatives_8cc.html#a838a54fc0838a6e7dcf1b1672df50158">p</a>, <a class="code hl_enumeration" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876">Type</a> <a class="code hl_function" href="namespacemadness.html#ac04610aea88b4041699b7315bbe4dce2">type</a>)</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>            : <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>(<a class="code hl_function" href="derivatives_8cc.html#a838a54fc0838a6e7dcf1b1672df50158">p</a>), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">point</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>.level()), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>(<a class="code hl_function" href="namespacemadness.html#ac04610aea88b4041699b7315bbe4dce2">type</a> == <a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9">End</a> ? <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a> : 0), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">done</a>(<a class="code hl_function" href="namespacemadness.html#ac04610aea88b4041699b7315bbe4dce2">type</a> == <a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9">End</a>) {</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacemadness.html#ac04610aea88b4041699b7315bbe4dce2">type</a> != <a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9">End</a>) {</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>            <span class="comment">// skip to first dimensions with limited range</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>            <span class="keywordflow">while</span> (!<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>[<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>] &amp;&amp; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a> &lt; <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>) {</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>              ++<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">fixed_dim</a>;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>            }</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a> = 0; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a> != <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>) {</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>              <span class="comment">// min/max displacements along this axis ... N.B. take into account surface thickness!</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">box</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] ? std::pair{<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].first -</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>                                <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].value_or(0),</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                         <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].second +</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                             <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].value_or(0)} : <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">parent</a>-&gt;<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>];</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>              <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9658b78a4d05dba0823d3b5078e24a69">reset_along_dim</a>(<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>);</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>            }</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aa1bd486595fd933abc26de1c97326bed">advance_till_valid</a>();</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>          }</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        }</div>
</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="comment"></span> </div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="comment">         * @brief Dereferences the iterator</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="comment">         * @return A const reference to the current displacement</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="comment">         */</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a8c7aa4feb6b31d9602c1711a0029bf53">  560</a></span>        <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aea15ac3cf4c0ff806346c6a87d898915">reference</a> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a8c7aa4feb6b31d9602c1711a0029bf53">operator*</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a20194a2b4ec5c95cafe21682f247434c">displacement</a>(); }</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="comment"></span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span><span class="comment">         * @brief Arrow operator for member access</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="comment">         * @return A const pointer to the current displacement</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="comment">         */</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39cc310b9dccbe400c3b0310a6a741a0">  566</a></span>        <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39b2564e247a4a6f4ebc4db709cc2c18">pointer</a> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39cc310b9dccbe400c3b0310a6a741a0">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;(*(*this)); }</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="comment"></span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><span class="comment">         * @brief Pre-increment operator</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="comment">         * @return Reference to this iterator after advancement</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00572" data-start="{" data-end="}">
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ae44025ef86f27fe69024d1068907ce57">  572</a></span>        <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ae44025ef86f27fe69024d1068907ce57">operator++</a>() {</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>          <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aa1bd486595fd933abc26de1c97326bed">advance_till_valid</a>();</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>          <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>        }</div>
</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span><span class="comment"></span> </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="comment">         * @brief Post-increment operator</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="comment">         * @return Copy of the iterator before advancement</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00581" data-start="{" data-end="}">
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a5c6ec01e9218ffab3212d726f1bff665">  581</a></span>        <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a5c6ec01e9218ffab3212d726f1bff665">operator++</a>(<span class="keywordtype">int</span>) {</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>          <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a> tmp = *<span class="keyword">this</span>;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>          ++(*this);</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>          <span class="keywordflow">return</span> tmp;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        }</div>
</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="comment"></span> </div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="comment">         * @brief Equality comparison operator</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">         * @param a First iterator</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span><span class="comment">         * @param b Second iterator</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span><span class="comment">         * @return true if iterators are equivalent</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00593" data-start="{" data-end="};">
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#adf9a9358b475317bd816d7b47a0f5cd1">  593</a></span>        <span class="keyword">friend</span> <span class="keywordtype">bool</span> <a class="code hl_friend" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#adf9a9358b475317bd816d7b47a0f5cd1">operator==</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>, <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>) {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>.done &amp;&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>.done) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>.done || <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>.done) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>.fixed_dim == <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>.fixed_dim &amp;&amp;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                 <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>.point == <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>.point;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        }</div>
</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span><span class="comment"></span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span><span class="comment">        /**</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="comment">         * @brief Inequality comparison operator</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="comment">         * @param a First iterator</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span><span class="comment">         * @param b Second iterator</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="comment">         * @return true if iterators are not equivalent</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="comment">         */</span></div>
<div class="foldopen" id="foldopen00606" data-start="{" data-end="};">
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a27aed9f3ea67a677964fa51de28a5824">  606</a></span>        <span class="keyword">friend</span> <span class="keywordtype">bool</span> <a class="code hl_friend" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a27aed9f3ea67a677964fa51de28a5824">operator!=</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a>, <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>&amp; <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>) {</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>          <span class="keywordflow">return</span> !(<a class="code hl_variable" href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a> == <a class="code hl_variable" href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a>);</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        }</div>
</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>      };</div>
</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a9830fc407400559db7e7783cc10a9394">  611</a></span>      <span class="keyword">friend</span> <span class="keyword">class </span><a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span> </div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="comment">       * @brief Constructs a box with different sizes for each dimension</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="comment">       *</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span><span class="comment">       * @param center Center of the box</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="comment">       * @param box_radius Box radius in each dimension</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="comment">       * @param surface_thickness Surface thickness in each dimension</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="comment">       * @param is_periodic whether each dimension is periodic; along periodic range-restricted dimensions only one side of the box is iterated over.</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="comment">       * @param filter Optional filter function (if returns false, displacement is dropped; default: no filter); it may update the displacement to make it valid as needed (e.g. map displacement to the simulation cell)</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="comment">       * @pre `box_radius[d]&gt;0 &amp;&amp; surface_thickness[d]&lt;=box_radius[d]`</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="comment">       *</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="comment">       */</span></div>
<div class="foldopen" id="foldopen00625" data-start="{" data-end="}">
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71ccec5785a3414e99298eb5f91dc7b0">  625</a></span>      <span class="keyword">explicit</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71ccec5785a3414e99298eb5f91dc7b0">BoxSurfaceDisplacementRange</a>(<span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a19d7ce8bdce167241e7146d3085f78f1">center</a>,</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>                                           <span class="keyword">const</span> std::array&lt;std::optional&lt;std::int64_t&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1f105eef2843200ca7c25ee0cb44af0a">box_radius</a>,</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>                                           <span class="keyword">const</span> std::array&lt;std::optional&lt;std::int64_t&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71cc68a7ffeca4fc3df3e65c649c3ff6">surface_thickness</a>,</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>                                           <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#acb9abdf176f710b6cd5513bcd4c32447">is_periodic</a>,</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>                                           <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab6435a1abf1285d86a132355a21cf2b1">Filter</a> filter = {})</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>          : <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>(<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a19d7ce8bdce167241e7146d3085f78f1">center</a>), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>(<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1f105eef2843200ca7c25ee0cb44af0a">box_radius</a>),</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>(<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71cc68a7ffeca4fc3df3e65c649c3ff6">surface_thickness</a>), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab10286f5727fb4dd404c54275c0b9f7f">is_periodic_</a>(<a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#acb9abdf176f710b6cd5513bcd4c32447">is_periodic</a>), <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">filter_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(filter)) {</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <span class="comment">// initialize box bounds</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="keywordtype">bool</span> has_finite_dimensions = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keyword">const</span> <span class="keyword">auto</span> n = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>.level();</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;Translation, NDIM&gt;</a> probing_displacement_vec(0);</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>=0; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>!= <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>) {</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>          <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>]) {</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>            <span class="keyword">auto</span> r = *<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>];  <span class="comment">// in units of 2^{n-1}</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>            r = (n == 0) ? (r+1)/2 : (r * <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a>(1) &lt;&lt; (n-1));</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(r &gt; 0);</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] = {<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] - r, <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] + r};</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>            <span class="keywordflow">if</span> (!has_finite_dimensions) <span class="comment">// first finite dimension? probing displacement will be nonzero along it, zero along all others</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>              probing_displacement_vec[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] = r;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>            has_finite_dimensions = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] = {0, (1 &lt;&lt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>.level()) - 1};</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>          }</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        }</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(has_finite_dimensions);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a0704fdd77a49e835157ac0a88a4fb30f">probing_displacement_</a> = <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abd18dadf37895989f0f79bd4ee1d2742">Displacement</a>(n, probing_displacement_vec);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>=0; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>!= <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>) {</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>          <span class="comment">// surface thickness should be only given for finite-radius dimensions</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>          <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(!(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].has_value() ^ <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].has_value()));</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>          <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].value_or(0) &gt;= 0);</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>          <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">hollowness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] ? (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].first + <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].value() &lt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">box_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].second - <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].value()) : false;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        }</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>      }</div>
</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span><span class="comment"></span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span><span class="comment">     * @brief Returns an iterator to the beginning of the surface points</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span><span class="comment">     * @return Iterator pointing to the first surface point</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span><span class="comment">       */</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7db05f099ba681b2f589ad408820efc0">  663</a></span>      <span class="keyword">auto</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7db05f099ba681b2f589ad408820efc0">begin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>(<span class="keyword">this</span>, <a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a984b9e1c834b2174ba476bcefacb7065">Iterator::Begin</a>); }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="comment"></span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment">     * @brief Returns an iterator to the end of the surface points</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="comment">     * @return Iterator indicating the end of iteration</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="comment">       */</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#adf24885c6210739a4044fd5206e2b0ee">  669</a></span>      <span class="keyword">auto</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#adf24885c6210739a4044fd5206e2b0ee">end</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">Iterator</a>(<span class="keyword">this</span>, <a class="code hl_enumvalue" href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9">Iterator::End</a>); }</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>      <span class="comment">//      /**</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>      <span class="comment">//     * @brief Returns a view over the surface points</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>      <span class="comment">//     *</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>      <span class="comment">//     * This operator allows the class to be used with C++20 ranges.</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>      <span class="comment">//     *</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>      <span class="comment">//     * @return A view over the surface points</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>      <span class="comment">//       */</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>      <span class="comment">//      auto operator()() const {</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>      <span class="comment">//        return std::ranges::subrange(begin(), end());</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>      <span class="comment">//      }</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>      <span class="comment">/* @return the center of the box</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span><span class="comment">       */</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a19d7ce8bdce167241e7146d3085f78f1">  684</a></span>      <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a19d7ce8bdce167241e7146d3085f78f1">center</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">center_</a>; }</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span><span class="comment"></span> </div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span><span class="comment">        * @return the radius of the box in each dimension</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span><span class="comment">       */</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1f105eef2843200ca7c25ee0cb44af0a">  689</a></span>      <span class="keyword">const</span> std::array&lt;std::optional&lt;int64_t&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1f105eef2843200ca7c25ee0cb44af0a">box_radius</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">box_radius_</a>; }</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="comment"></span> </div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment">        * @return the surface thickness in each dimension</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span><span class="comment">       */</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71cc68a7ffeca4fc3df3e65c649c3ff6">  694</a></span>      <span class="keyword">const</span> std::array&lt;std::optional&lt;int64_t&gt;, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71cc68a7ffeca4fc3df3e65c649c3ff6">surface_thickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">surface_thickness_</a>; }</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="comment"></span> </div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span><span class="comment">       * @return flags indicating whether each dimension is periodic</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="comment">       */</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#acb9abdf176f710b6cd5513bcd4c32447">  699</a></span>      <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#acb9abdf176f710b6cd5513bcd4c32447">is_periodic</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab10286f5727fb4dd404c54275c0b9f7f">is_periodic_</a>; }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span><span class="comment"></span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span><span class="comment">      /**</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="comment">       * @return &#39;probing&quot; displacement to a nearby point *on* the surface; it may not necessarily be in the range of iteration (e.g., it may not be able to pass the filter) but is representative of the surface displacements for the purposes of screening</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span><span class="comment">       */</span></div>
<div class="foldopen" id="foldopen00704" data-start="{" data-end="}">
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a9608dcce244efb09fdc216bb9bd01884">  704</a></span>      <span class="keyword">const</span> <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementRange.html#abd18dadf37895989f0f79bd4ee1d2742">Displacement</a>&amp; <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a9608dcce244efb09fdc216bb9bd01884">probing_displacement</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementRange.html#a0704fdd77a49e835157ac0a88a4fb30f">probing_displacement_</a>;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>      }</div>
</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    };  <span class="comment">// BoxSurfaceDisplacementRange</span></div>
</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="comment"></span> </div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span><span class="comment">    /// This is used to filter out box surface displacements that</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span><span class="comment">    /// - take us outside of the target domain, or</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span><span class="comment">    /// - were already utilized as part of the the standard displacements list.</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span><span class="comment">    /// For dealing with the lattice-summed operators the filter</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span><span class="comment">    /// can adjusts the displacement to make sure that we end up in</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span><span class="comment">    /// the simulation cell.</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span><span class="comment"></span>    <span class="keyword">template</span> &lt;<span class="keywordtype">size_t</span> NDIM&gt;</div>
<div class="foldopen" id="foldopen00717" data-start="{" data-end="};">
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html">  717</a></span>    <span class="keyword">class </span><a class="code hl_class" href="classmadness_1_1BoxSurfaceDisplacementFilter.html">BoxSurfaceDisplacementFilter</a> {</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    <span class="keyword">public</span>:</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a7e08768d408a3bd658632a825cfeefe6">  719</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a7e08768d408a3bd658632a825cfeefe6">Point</a> = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>;</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a83648dbb22f0e53cde9d72ea29f40414">  720</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a83648dbb22f0e53cde9d72ea29f40414">PointPattern</a> = <a class="code hl_class" href="classmadness_1_1Vector.html">Vector&lt;std::optional&lt;Translation&gt;</a>, <a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>&gt;;</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ab7d1abd182db9e844fd694d2e7c5c55a">  721</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ab7d1abd182db9e844fd694d2e7c5c55a">Displacement</a> = <a class="code hl_class" href="classmadness_1_1Key.html">Key&lt;NDIM&gt;</a>;</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#aed6a36b15948f66b989dc71dc022edff">  722</a></span>      <span class="keyword">using </span><a class="code hl_class" href="classmadness_1_1array__of__bools.html">Periodicity</a> = <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a612df49a3bcd1aadff5cef834ecf2757">  723</a></span>      <span class="keyword">using </span><a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a612df49a3bcd1aadff5cef834ecf2757">DistanceSquaredFunc</a> = std::function&lt;<a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a>(<span class="keyword">const</span> <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ab7d1abd182db9e844fd694d2e7c5c55a">Displacement</a>&amp;)&gt;;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span><span class="comment"></span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="comment">      /// \param domain_is_infinite whether the domain along each axis is finite (simulation cell) or infinite (the entire axis); if true for a given axis then any destination coordinate is valid, else only values in [0,2^n) are valid</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span><span class="comment">      /// \param domain_is_periodic if true for a given axis, displacement to x and x+2^n are equivalent, hence will be canonicalized to end up in the simulation cell. Periodic axes imply infinite domain.</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span><span class="comment">      /// \param range the kernel range for each axis</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="comment">      /// \param default_distance_squared function that converts a displacement to its effective distance squared (effective may be different from the real distance squared due to periodicity)</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span><span class="comment">      /// \param max_distsq_reached max effective distance squared reached by standard displacements</span></div>
<div class="foldopen" id="foldopen00730" data-start="{" data-end="}">
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ae9d6623daa8bc913b1a26043961720e2">  730</a></span><span class="comment"></span>      <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ae9d6623daa8bc913b1a26043961720e2">BoxSurfaceDisplacementFilter</a>(</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>          <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>&amp; domain_is_infinite,</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>          <span class="keyword">const</span> <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a>&amp; domain_is_periodic,</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>          <span class="keyword">const</span> std::array&lt;KernelRange, NDIM&gt;&amp; range,</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>          <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a612df49a3bcd1aadff5cef834ecf2757">DistanceSquaredFunc</a> default_distance_squared,</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>          <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> max_distsq_reached</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>          ) :</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a40c44093515a350230c79f8e7d71add1">domain_is_infinite_</a>(domain_is_infinite),</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a324860db8983855b616d5a71c63cf460">domain_is_periodic_</a>(domain_is_periodic),</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a411fc748d3800deaf18266325b3978ff">range_</a>(range),</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a806554f70244204c420d3f82f476d765">default_distance_squared_</a>(default_distance_squared),</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>              <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a76b97fdd123963439e8f4dcdfab95b6b">max_distsq_reached_</a>(max_distsq_reached)</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>      {}</div>
</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span><span class="comment"></span> </div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span><span class="comment">      /// Apply filter to a displacement ending up at a point or a group of points (point pattern)</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span><span class="comment">      /// @param level the tree level</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span><span class="comment">      /// @param dest the target point (when all elements are nonnull) or point pattern (when only some are).</span></div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span><span class="comment">      ///        The latter is useful to skip the entire surface layer. The point coordinates are</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span><span class="comment">      ///        only used to determine whether we end up in or out of the domain.</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span><span class="comment">      /// @param displacement the optional displacement; if given then will check if it&#39;s among</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span><span class="comment">      ///        the standard displacement and whether it was used as part of the standard displacement</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span><span class="comment">      ///        set; if it has not been used and the operator is lattice summed, the displacement</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span><span class="comment">      ///        will be adjusted to end up in the simulation cell.</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="comment">      /// @return true if the displacement is to be used</span></div>
<div class="foldopen" id="foldopen00755" data-start="{" data-end="}">
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a2bca2daae08fe01366a98d8bfff121a7">  755</a></span><span class="comment"></span>      <span class="keywordtype">bool</span> <a class="code hl_function" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a2bca2daae08fe01366a98d8bfff121a7">operator()</a>(</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">Level</a> level,</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>          <span class="keyword">const</span> <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a83648dbb22f0e53cde9d72ea29f40414">PointPattern</a>&amp; dest,</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>          std::optional&lt;Displacement&gt;&amp;  <a class="code hl_function" href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">displacement</a></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>      )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>        <span class="comment">// preliminaries</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        <span class="keyword">const</span> <span class="keyword">auto</span> twon = (<span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a><span class="keyword">&gt;</span>(1) &lt;&lt; level);  <span class="comment">// number of boxes along an axis</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        <span class="comment">// map_to_range_twon(x) returns for x &gt;= 0 ? x % 2^level : map_to_range_twon(x+2^level)</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="comment">// idiv is generally slow, so instead use bit logic that relies on 2&#39;s complement representation of integers</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>        <span class="keyword">const</span> <span class="keyword">auto</span> map_to_range_twon = [&amp;, <a class="code hl_variable" href="dirac-hatom_8cc.html#a5d2bc9cf5cb31f48733d683b47e7a10a">mask</a> = ((~(<span class="keyword">static_cast&lt;</span>std::uint64_t<span class="keyword">&gt;</span>(0)) &lt;&lt; (64-level)) &gt;&gt; (64-level))](std::int64_t x) -&gt; std::int64_t {</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>          <span class="keyword">const</span> std::int64_t x_mapped = x &amp; <a class="code hl_variable" href="dirac-hatom_8cc.html#a5d2bc9cf5cb31f48733d683b47e7a10a">mask</a>;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>          <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(x_mapped &gt;=0 &amp;&amp; x_mapped &lt; twon &amp;&amp; (<a class="code hl_function" href="namespacestd.html#abd13c8061bb606bae54f873cf31bf559">std::abs</a>(x_mapped-x)%twon==0));</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>          <span class="keywordflow">return</span> x_mapped;</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>        };</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="keyword">const</span> <span class="keyword">auto</span> out_of_domain = [&amp;](<span class="keyword">const</span> <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a>&amp; t) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>          <span class="keywordflow">return</span> t &lt; 0 || t &gt;= twon;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        };</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        <span class="comment">// check that dest is in the domain</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> dest_is_in_domain = [&amp;]() {</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>          <span class="keywordflow">for</span>(<span class="keyword">auto</span> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>=0; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>!=<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>) {</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>            <span class="comment">// - if domain is periodic, all displacements will be mapped back to the simulation cell by for_each/neighbor</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>            <span class="comment">// - if kernel is lattice summed mapping back to the simulation cell for standard displacements</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>            <span class="comment">//   is done during their construction, and for boundary displacements manually (see IMPORTANT below in this function)</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            <span class="comment">//   N.B. due to this mapping back into the cell only half of the surface displacements was generated by BoxSurfaceDisplacementRange</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a40c44093515a350230c79f8e7d71add1">domain_is_infinite_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] || <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a324860db8983855b616d5a71c63cf460">domain_is_periodic_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>            <span class="keywordflow">if</span> (dest[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].has_value() &amp;&amp; out_of_domain(*dest[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>])) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>          }</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>        }();</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span> </div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        <span class="keywordflow">if</span> (dest_is_in_domain) {</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">displacement</a>.has_value()) {</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span> </div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>            <span class="comment">// N.B. avoid duplicates of standard displacements previously included:</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>            <span class="comment">// A displacement has been possibly considered if along EVERY axis the &quot;effective&quot; displacement size</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>            <span class="comment">// fits within the box explored by the standard displacement.</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>            <span class="comment">// If so, skip if &lt;= max magnitude of standard displacements encountered</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>            <span class="comment">// Otherwise this is a new non-standard displacement, consider it</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>            <span class="keywordtype">bool</span> among_standard_displacements = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>            <span class="keywordflow">for</span>(<span class="keyword">auto</span> <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>=0; <a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>!=<a class="code hl_variable" href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a>; ++<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>) {</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>              <span class="keyword">const</span> <span class="keyword">auto</span> disp_d = (*displacement)[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>];</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>              <span class="keyword">auto</span> bmax_standard = <a class="code hl_function" href="classmadness_1_1Displacements.html#aa0ea990f0768c70bef4516a7b9e1b970">Displacements&lt;NDIM&gt;::bmax_default</a>();</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>              <span class="comment">// the effective displacement length depends on whether lattice summation is performed along it</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>              <span class="comment">// compare Displacements::make_disp vs Displacements::make_disp_periodic</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>              <span class="keyword">auto</span> disp_d_eff_abs = <a class="code hl_function" href="namespacestd.html#abd13c8061bb606bae54f873cf31bf559">std::abs</a>(disp_d);</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>              <span class="keywordflow">if</span> (<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a324860db8983855b616d5a71c63cf460">domain_is_periodic_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>]) {</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>                <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(<a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a411fc748d3800deaf18266325b3978ff">range_</a>[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].<a class="code hl_define" href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>() &lt;= 2);  <span class="comment">// displacements that exceed 1 whole cell need bit more complex logic</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span> </div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                <span class="comment">// for &quot;periodic&quot; displacements the effective disp_d is the shortest of {..., disp_d-twon, disp_d, disp_d+twon, ...} ... see make_disp_periodic</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                <span class="keyword">const</span> std::int64_t disp_d_eff = map_to_range_twon(disp_d);</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>                disp_d_eff_abs = std::min(disp_d_eff,<a class="code hl_function" href="namespacestd.html#abd13c8061bb606bae54f873cf31bf559">std::abs</a>(disp_d_eff-twon));</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                <span class="comment">// IMPORTANT for lattice-summed axes, if the destination is out of the simulation cell map the displacement back to the cell</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                <span class="comment">// same logic as for disp_d: dest[d] -&gt; dest[d] % twon</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                <span class="keywordflow">if</span> (dest[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].has_value()) {</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>                  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> dest_d = dest[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>].value();</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>                  <span class="keyword">const</span> <span class="keyword">auto</span> dest_d_in_cell = map_to_range_twon(dest_d);</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>                  <a class="code hl_define" href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a>(!out_of_domain(</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>                      dest_d_in_cell));</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>                  <span class="comment">// adjust displacement[d] so that it produces dest_d_cell, not dest_d</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>                  <span class="keyword">auto</span> t = (*displacement).translation();</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>                  t[<a class="code hl_variable" href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a>] += (dest_d_in_cell - dest_d);</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>                  <a class="code hl_function" href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">displacement</a>.emplace(<a class="code hl_function" href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">displacement</a>-&gt;level(), t);</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>                }</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>                <span class="comment">// N.B. bmax in make_disp_periodic is wrapped around, adjust</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>                <span class="keywordflow">if</span> (<a class="code hl_class" href="classmadness_1_1Displacements.html">Displacements&lt;NDIM&gt;::bmax_default</a>() &gt;= twon) bmax_standard = twon-1;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>              }</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>              <span class="keywordflow">if</span> (disp_d_eff_abs &gt; bmax_standard) {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                among_standard_displacements = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>              }</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>            }</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            <span class="keywordflow">if</span> (among_standard_displacements) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>              <span class="keyword">const</span> <span class="keyword">auto</span> distsq = <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a806554f70244204c420d3f82f476d765">default_distance_squared_</a>(*<a class="code hl_function" href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">displacement</a>);</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>              <span class="keywordflow">if</span> (distsq &gt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a76b97fdd123963439e8f4dcdfab95b6b">max_distsq_reached_</a>) { <span class="comment">// among standard displacements =&gt; keep if longer than the longest standard displacement considered</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>              } {</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>              }</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>            }</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            <span class="keywordflow">else</span>  <span class="comment">// not among standard displacements =&gt; keep it</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>              <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>          }</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>          <span class="keywordflow">else</span>  <span class="comment">// skip the displacement-based filter if not given</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>        }</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>      }</div>
</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span> </div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="keyword">private</span>:</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a40c44093515a350230c79f8e7d71add1">  851</a></span>      <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a40c44093515a350230c79f8e7d71add1">domain_is_infinite_</a>;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a324860db8983855b616d5a71c63cf460">  852</a></span>      <a class="code hl_class" href="classmadness_1_1array__of__bools.html">array_of_bools&lt;NDIM&gt;</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a324860db8983855b616d5a71c63cf460">domain_is_periodic_</a>;</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a411fc748d3800deaf18266325b3978ff">  853</a></span>      std::array&lt;KernelRange, NDIM&gt; <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a411fc748d3800deaf18266325b3978ff">range_</a>;</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a806554f70244204c420d3f82f476d765">  854</a></span>      <a class="code hl_typedef" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a612df49a3bcd1aadff5cef834ecf2757">DistanceSquaredFunc</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a806554f70244204c420d3f82f476d765">default_distance_squared_</a>;</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno"><a class="line" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a76b97fdd123963439e8f4dcdfab95b6b">  855</a></span>      <a class="code hl_typedef" href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">Translation</a> <a class="code hl_variable" href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a76b97fdd123963439e8f4dcdfab95b6b">max_distsq_reached_</a>;</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>    };</div>
</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span> </div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>}  <span class="comment">// namespace madness</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span><span class="preprocessor">#endif </span><span class="comment">// MADNESS_MRA_DISPLACEMENTS_H__INCLUDED</span></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html">madness::BoxSurfaceDisplacementFilter</a></div><div class="ttdef"><b>Definition</b> displacements.h:717</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a2bca2daae08fe01366a98d8bfff121a7"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a2bca2daae08fe01366a98d8bfff121a7">madness::BoxSurfaceDisplacementFilter::operator()</a></div><div class="ttdeci">bool operator()(const Level level, const PointPattern &amp;dest, std::optional&lt; Displacement &gt; &amp;displacement) const</div><div class="ttdoc">Apply filter to a displacement ending up at a point or a group of points (point pattern)</div><div class="ttdef"><b>Definition</b> displacements.h:755</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a324860db8983855b616d5a71c63cf460"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a324860db8983855b616d5a71c63cf460">madness::BoxSurfaceDisplacementFilter::domain_is_periodic_</a></div><div class="ttdeci">array_of_bools&lt; NDIM &gt; domain_is_periodic_</div><div class="ttdef"><b>Definition</b> displacements.h:852</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a40c44093515a350230c79f8e7d71add1"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a40c44093515a350230c79f8e7d71add1">madness::BoxSurfaceDisplacementFilter::domain_is_infinite_</a></div><div class="ttdeci">array_of_bools&lt; NDIM &gt; domain_is_infinite_</div><div class="ttdef"><b>Definition</b> displacements.h:851</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a411fc748d3800deaf18266325b3978ff"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a411fc748d3800deaf18266325b3978ff">madness::BoxSurfaceDisplacementFilter::range_</a></div><div class="ttdeci">std::array&lt; KernelRange, NDIM &gt; range_</div><div class="ttdef"><b>Definition</b> displacements.h:853</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a612df49a3bcd1aadff5cef834ecf2757"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a612df49a3bcd1aadff5cef834ecf2757">madness::BoxSurfaceDisplacementFilter::DistanceSquaredFunc</a></div><div class="ttdeci">std::function&lt; Translation(const Displacement &amp;)&gt; DistanceSquaredFunc</div><div class="ttdef"><b>Definition</b> displacements.h:723</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a76b97fdd123963439e8f4dcdfab95b6b"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a76b97fdd123963439e8f4dcdfab95b6b">madness::BoxSurfaceDisplacementFilter::max_distsq_reached_</a></div><div class="ttdeci">Translation max_distsq_reached_</div><div class="ttdef"><b>Definition</b> displacements.h:855</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a7e08768d408a3bd658632a825cfeefe6"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a7e08768d408a3bd658632a825cfeefe6">madness::BoxSurfaceDisplacementFilter::Point</a></div><div class="ttdeci">Key&lt; NDIM &gt; Point</div><div class="ttdef"><b>Definition</b> displacements.h:719</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a806554f70244204c420d3f82f476d765"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a806554f70244204c420d3f82f476d765">madness::BoxSurfaceDisplacementFilter::default_distance_squared_</a></div><div class="ttdeci">DistanceSquaredFunc default_distance_squared_</div><div class="ttdef"><b>Definition</b> displacements.h:854</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_a83648dbb22f0e53cde9d72ea29f40414"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#a83648dbb22f0e53cde9d72ea29f40414">madness::BoxSurfaceDisplacementFilter::PointPattern</a></div><div class="ttdeci">Vector&lt; std::optional&lt; Translation &gt;, NDIM &gt; PointPattern</div><div class="ttdef"><b>Definition</b> displacements.h:720</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_ab7d1abd182db9e844fd694d2e7c5c55a"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ab7d1abd182db9e844fd694d2e7c5c55a">madness::BoxSurfaceDisplacementFilter::Displacement</a></div><div class="ttdeci">Key&lt; NDIM &gt; Displacement</div><div class="ttdef"><b>Definition</b> displacements.h:721</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementFilter_html_ae9d6623daa8bc913b1a26043961720e2"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementFilter.html#ae9d6623daa8bc913b1a26043961720e2">madness::BoxSurfaceDisplacementFilter::BoxSurfaceDisplacementFilter</a></div><div class="ttdeci">BoxSurfaceDisplacementFilter(const array_of_bools&lt; NDIM &gt; &amp;domain_is_infinite, const array_of_bools&lt; NDIM &gt; &amp;domain_is_periodic, const std::array&lt; KernelRange, NDIM &gt; &amp;range, DistanceSquaredFunc default_distance_squared, Translation max_distsq_reached)</div><div class="ttdef"><b>Definition</b> displacements.h:730</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html">madness::BoxSurfaceDisplacementRange::Iterator</a></div><div class="ttdoc">Iterator class for lazy generation of surface points.</div><div class="ttdef"><b>Definition</b> displacements.h:325</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a070c01eeba750a94f8f4a0fc5fbfb6d9"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a070c01eeba750a94f8f4a0fc5fbfb6d9">madness::BoxSurfaceDisplacementRange::Iterator::disp</a></div><div class="ttdeci">std::optional&lt; Displacement &gt; disp</div><div class="ttdoc">Memoized displacement from parent-&gt;center_ to point, computed by displacement(), reset by advance()</div><div class="ttdef"><b>Definition</b> displacements.h:331</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a0837865ff3452b67186011c41e465fbc"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0837865ff3452b67186011c41e465fbc">madness::BoxSurfaceDisplacementRange::Iterator::Iterator</a></div><div class="ttdeci">Iterator(const BoxSurfaceDisplacementRange *p, Type type)</div><div class="ttdoc">Constructs an iterator.</div><div class="ttdef"><b>Definition</b> displacements.h:536</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a0ca7609cedc172e37cb567ff1becd876"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876">madness::BoxSurfaceDisplacementRange::Iterator::Type</a></div><div class="ttdeci">Type</div><div class="ttdef"><b>Definition</b> displacements.h:327</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a787ba44a62d6faf48c72bee93e2ff5a9">madness::BoxSurfaceDisplacementRange::Iterator::End</a></div><div class="ttdeci">@ End</div><div class="ttdef"><b>Definition</b> displacements.h:327</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a0ca7609cedc172e37cb567ff1becd876a984b9e1c834b2174ba476bcefacb7065"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a0ca7609cedc172e37cb567ff1becd876a984b9e1c834b2174ba476bcefacb7065">madness::BoxSurfaceDisplacementRange::Iterator::Begin</a></div><div class="ttdeci">@ Begin</div><div class="ttdef"><b>Definition</b> displacements.h:327</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a11fb7a51582d8ce49b7d4cd5c85137c8"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a11fb7a51582d8ce49b7d4cd5c85137c8">madness::BoxSurfaceDisplacementRange::Iterator::fixed_dim</a></div><div class="ttdeci">size_t fixed_dim</div><div class="ttdoc">Current fixed dimension (i.e. faces perpendicular to this axis are being iterated over)</div><div class="ttdef"><b>Definition</b> displacements.h:332</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a20194a2b4ec5c95cafe21682f247434c"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a20194a2b4ec5c95cafe21682f247434c">madness::BoxSurfaceDisplacementRange::Iterator::displacement</a></div><div class="ttdeci">const std::optional&lt; Displacement &gt; &amp; displacement() const</div><div class="ttdef"><b>Definition</b> displacements.h:515</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a27aed9f3ea67a677964fa51de28a5824"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a27aed9f3ea67a677964fa51de28a5824">madness::BoxSurfaceDisplacementRange::Iterator::operator!=</a></div><div class="ttdeci">friend bool operator!=(const Iterator &amp;a, const Iterator &amp;b)</div><div class="ttdoc">Inequality comparison operator.</div><div class="ttdef"><b>Definition</b> displacements.h:606</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a33c2fe05b628d11b612a760fceff3436"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a33c2fe05b628d11b612a760fceff3436">madness::BoxSurfaceDisplacementRange::Iterator::done</a></div><div class="ttdeci">bool done</div><div class="ttdoc">Flag indicating iteration completion.</div><div class="ttdef"><b>Definition</b> displacements.h:334</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a39b2564e247a4a6f4ebc4db709cc2c18"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39b2564e247a4a6f4ebc4db709cc2c18">madness::BoxSurfaceDisplacementRange::Iterator::pointer</a></div><div class="ttdeci">const Point * pointer</div><div class="ttdef"><b>Definition</b> displacements.h:527</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a39cc310b9dccbe400c3b0310a6a741a0"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a39cc310b9dccbe400c3b0310a6a741a0">madness::BoxSurfaceDisplacementRange::Iterator::operator-&gt;</a></div><div class="ttdeci">pointer operator-&gt;() const</div><div class="ttdoc">Arrow operator for member access.</div><div class="ttdef"><b>Definition</b> displacements.h:566</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a5c6ec01e9218ffab3212d726f1bff665"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a5c6ec01e9218ffab3212d726f1bff665">madness::BoxSurfaceDisplacementRange::Iterator::operator++</a></div><div class="ttdeci">Iterator operator++(int)</div><div class="ttdoc">Post-increment operator.</div><div class="ttdef"><b>Definition</b> displacements.h:581</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a7a8b3875d4063f32e95343cd5629d246"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7a8b3875d4063f32e95343cd5629d246">madness::BoxSurfaceDisplacementRange::Iterator::difference_type</a></div><div class="ttdeci">std::ptrdiff_t difference_type</div><div class="ttdef"><b>Definition</b> displacements.h:526</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a7d7fe3107ddf0a35e525fa1158098ff1"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7d7fe3107ddf0a35e525fa1158098ff1">madness::BoxSurfaceDisplacementRange::Iterator::iterator_category</a></div><div class="ttdeci">std::input_iterator_tag iterator_category</div><div class="ttdef"><b>Definition</b> displacements.h:524</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a7f1aaedcb43c7c717c2fba0f96bd48ab"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7f1aaedcb43c7c717c2fba0f96bd48ab">madness::BoxSurfaceDisplacementRange::Iterator::box</a></div><div class="ttdeci">Box box</div><div class="ttdoc">updated box bounds in each dimension, used to avoid duplicate displacements by excluding the surface ...</div><div class="ttdef"><b>Definition</b> displacements.h:333</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a7fe4f6decca9b6a3427e6da77a7319ee"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a7fe4f6decca9b6a3427e6da77a7319ee">madness::BoxSurfaceDisplacementRange::Iterator::parent</a></div><div class="ttdeci">const BoxSurfaceDisplacementRange * parent</div><div class="ttdoc">Pointer to parent box.</div><div class="ttdef"><b>Definition</b> displacements.h:329</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a85ed23aae700e21ce894cdec5f8e2efa"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a85ed23aae700e21ce894cdec5f8e2efa">madness::BoxSurfaceDisplacementRange::Iterator::next_surface_layer</a></div><div class="ttdeci">bool next_surface_layer()</div><div class="ttdef"><b>Definition</b> displacements.h:337</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a8c7aa4feb6b31d9602c1711a0029bf53"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a8c7aa4feb6b31d9602c1711a0029bf53">madness::BoxSurfaceDisplacementRange::Iterator::operator*</a></div><div class="ttdeci">reference operator*() const</div><div class="ttdoc">Dereferences the iterator.</div><div class="ttdef"><b>Definition</b> displacements.h:560</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a9066b9d139a99175d87f1de4ccefaab6"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9066b9d139a99175d87f1de4ccefaab6">madness::BoxSurfaceDisplacementRange::Iterator::value_type</a></div><div class="ttdeci">Point value_type</div><div class="ttdef"><b>Definition</b> displacements.h:525</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_a9658b78a4d05dba0823d3b5078e24a69"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#a9658b78a4d05dba0823d3b5078e24a69">madness::BoxSurfaceDisplacementRange::Iterator::reset_along_dim</a></div><div class="ttdeci">void reset_along_dim(size_t dim)</div><div class="ttdef"><b>Definition</b> displacements.h:453</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_aa1bd486595fd933abc26de1c97326bed"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aa1bd486595fd933abc26de1c97326bed">madness::BoxSurfaceDisplacementRange::Iterator::advance_till_valid</a></div><div class="ttdeci">void advance_till_valid()</div><div class="ttdef"><b>Definition</b> displacements.h:435</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_ac793519bfb04520722ad99275d93ac05"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ac793519bfb04520722ad99275d93ac05">madness::BoxSurfaceDisplacementRange::Iterator::point</a></div><div class="ttdeci">Point point</div><div class="ttdoc">Current point.</div><div class="ttdef"><b>Definition</b> displacements.h:330</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_adf9a9358b475317bd816d7b47a0f5cd1"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#adf9a9358b475317bd816d7b47a0f5cd1">madness::BoxSurfaceDisplacementRange::Iterator::operator==</a></div><div class="ttdeci">friend bool operator==(const Iterator &amp;a, const Iterator &amp;b)</div><div class="ttdoc">Equality comparison operator.</div><div class="ttdef"><b>Definition</b> displacements.h:593</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_ae44025ef86f27fe69024d1068907ce57"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#ae44025ef86f27fe69024d1068907ce57">madness::BoxSurfaceDisplacementRange::Iterator::operator++</a></div><div class="ttdeci">Iterator &amp; operator++()</div><div class="ttdoc">Pre-increment operator.</div><div class="ttdef"><b>Definition</b> displacements.h:572</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_aea15ac3cf4c0ff806346c6a87d898915"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#aea15ac3cf4c0ff806346c6a87d898915">madness::BoxSurfaceDisplacementRange::Iterator::reference</a></div><div class="ttdeci">const Point &amp; reference</div><div class="ttdef"><b>Definition</b> displacements.h:528</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator_html_af20c8fbd45bb15f3a6177edc5a23f27d"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange_1_1Iterator.html#af20c8fbd45bb15f3a6177edc5a23f27d">madness::BoxSurfaceDisplacementRange::Iterator::advance</a></div><div class="ttdeci">void advance()</div><div class="ttdoc">Advances the iterator to the next surface point.</div><div class="ttdef"><b>Definition</b> displacements.h:366</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html">madness::BoxSurfaceDisplacementRange</a></div><div class="ttdef"><b>Definition</b> displacements.h:294</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a0704fdd77a49e835157ac0a88a4fb30f"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a0704fdd77a49e835157ac0a88a4fb30f">madness::BoxSurfaceDisplacementRange::probing_displacement_</a></div><div class="ttdeci">Displacement probing_displacement_</div><div class="ttdoc">displacement to a nearby point on the surface; it may not be able to pass the filter,...</div><div class="ttdef"><b>Definition</b> displacements.h:317</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a1927eba0f766c3f30d516f8f1730c248"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1927eba0f766c3f30d516f8f1730c248">madness::BoxSurfaceDisplacementRange::Point</a></div><div class="ttdeci">Key&lt; NDIM &gt; Point</div><div class="ttdef"><b>Definition</b> displacements.h:296</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a19d7ce8bdce167241e7146d3085f78f1"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a19d7ce8bdce167241e7146d3085f78f1">madness::BoxSurfaceDisplacementRange::center</a></div><div class="ttdeci">const Key&lt; NDIM &gt; &amp; center() const</div><div class="ttdef"><b>Definition</b> displacements.h:684</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a1ee1f7f39983c5f123b08e99e136c97c"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1ee1f7f39983c5f123b08e99e136c97c">madness::BoxSurfaceDisplacementRange::SurfaceThickness</a></div><div class="ttdeci">std::array&lt; std::optional&lt; Translation &gt;, NDIM &gt; SurfaceThickness</div><div class="ttdef"><b>Definition</b> displacements.h:304</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a1f105eef2843200ca7c25ee0cb44af0a"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a1f105eef2843200ca7c25ee0cb44af0a">madness::BoxSurfaceDisplacementRange::box_radius</a></div><div class="ttdeci">const std::array&lt; std::optional&lt; int64_t &gt;, NDIM &gt; &amp; box_radius() const</div><div class="ttdef"><b>Definition</b> displacements.h:689</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a6688d3a9db3b290298794d789a45d8b2"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6688d3a9db3b290298794d789a45d8b2">madness::BoxSurfaceDisplacementRange::surface_thickness_</a></div><div class="ttdeci">SurfaceThickness surface_thickness_</div><div class="ttdoc">surface thickness in each dimension</div><div class="ttdef"><b>Definition</b> displacements.h:312</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a6864417be97a5f585ee963405e36ba11"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a6864417be97a5f585ee963405e36ba11">madness::BoxSurfaceDisplacementRange::BoxRadius</a></div><div class="ttdeci">std::array&lt; std::optional&lt; Translation &gt;, NDIM &gt; BoxRadius</div><div class="ttdef"><b>Definition</b> displacements.h:303</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a71cc68a7ffeca4fc3df3e65c649c3ff6"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71cc68a7ffeca4fc3df3e65c649c3ff6">madness::BoxSurfaceDisplacementRange::surface_thickness</a></div><div class="ttdeci">const std::array&lt; std::optional&lt; int64_t &gt;, NDIM &gt; &amp; surface_thickness() const</div><div class="ttdef"><b>Definition</b> displacements.h:694</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a71ccec5785a3414e99298eb5f91dc7b0"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a71ccec5785a3414e99298eb5f91dc7b0">madness::BoxSurfaceDisplacementRange::BoxSurfaceDisplacementRange</a></div><div class="ttdeci">BoxSurfaceDisplacementRange(const Key&lt; NDIM &gt; &amp;center, const std::array&lt; std::optional&lt; std::int64_t &gt;, NDIM &gt; &amp;box_radius, const std::array&lt; std::optional&lt; std::int64_t &gt;, NDIM &gt; &amp;surface_thickness, const array_of_bools&lt; NDIM &gt; &amp;is_periodic, Filter filter={})</div><div class="ttdoc">Constructs a box with different sizes for each dimension.</div><div class="ttdef"><b>Definition</b> displacements.h:625</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a7b5d6320e609cc15e1f1449b5a11f9cd"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7b5d6320e609cc15e1f1449b5a11f9cd">madness::BoxSurfaceDisplacementRange::hollowness_</a></div><div class="ttdeci">Hollowness hollowness_</div><div class="ttdoc">does box contain non-surface points along each dimension?</div><div class="ttdef"><b>Definition</b> displacements.h:314</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a7db05f099ba681b2f589ad408820efc0"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a7db05f099ba681b2f589ad408820efc0">madness::BoxSurfaceDisplacementRange::begin</a></div><div class="ttdeci">auto begin() const</div><div class="ttdoc">Returns an iterator to the beginning of the surface points.</div><div class="ttdef"><b>Definition</b> displacements.h:663</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a8b77e4d25c4e48be6f4746b7987df64b"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8b77e4d25c4e48be6f4746b7987df64b">madness::BoxSurfaceDisplacementRange::box_</a></div><div class="ttdeci">Box box_</div><div class="ttdoc">box bounds in each dimension</div><div class="ttdef"><b>Definition</b> displacements.h:313</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a8eec47909eec9208f6873c6e0d8d9eb0"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a8eec47909eec9208f6873c6e0d8d9eb0">madness::BoxSurfaceDisplacementRange::filter_</a></div><div class="ttdeci">Filter filter_</div><div class="ttdoc">optional filter function</div><div class="ttdef"><b>Definition</b> displacements.h:316</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_a9608dcce244efb09fdc216bb9bd01884"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#a9608dcce244efb09fdc216bb9bd01884">madness::BoxSurfaceDisplacementRange::probing_displacement</a></div><div class="ttdeci">const Displacement &amp; probing_displacement() const</div><div class="ttdef"><b>Definition</b> displacements.h:704</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_ab0a93e158e7c2afbc052fcc653f26ac8"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab0a93e158e7c2afbc052fcc653f26ac8">madness::BoxSurfaceDisplacementRange::center_</a></div><div class="ttdeci">Point center_</div><div class="ttdoc">Center point of the box.</div><div class="ttdef"><b>Definition</b> displacements.h:309</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_ab10286f5727fb4dd404c54275c0b9f7f"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab10286f5727fb4dd404c54275c0b9f7f">madness::BoxSurfaceDisplacementRange::is_periodic_</a></div><div class="ttdeci">Periodicity is_periodic_</div><div class="ttdoc">which dimensions are periodic?</div><div class="ttdef"><b>Definition</b> displacements.h:315</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_ab6435a1abf1285d86a132355a21cf2b1"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#ab6435a1abf1285d86a132355a21cf2b1">madness::BoxSurfaceDisplacementRange::Filter</a></div><div class="ttdeci">std::function&lt; bool(Level, const PointPattern &amp;, std::optional&lt; Displacement &gt; &amp;)&gt; Filter</div><div class="ttdoc">this callable filters out points and/or displacements; note that the displacement is optional (this u...</div><div class="ttdef"><b>Definition</b> displacements.h:300</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_abd18dadf37895989f0f79bd4ee1d2742"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#abd18dadf37895989f0f79bd4ee1d2742">madness::BoxSurfaceDisplacementRange::Displacement</a></div><div class="ttdeci">Key&lt; NDIM &gt; Displacement</div><div class="ttdef"><b>Definition</b> displacements.h:298</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_abdf1b732c29959b1578ef683a76b3e65"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#abdf1b732c29959b1578ef683a76b3e65">madness::BoxSurfaceDisplacementRange::Hollowness</a></div><div class="ttdeci">std::array&lt; bool, NDIM &gt; Hollowness</div><div class="ttdef"><b>Definition</b> displacements.h:306</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_acb9abdf176f710b6cd5513bcd4c32447"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#acb9abdf176f710b6cd5513bcd4c32447">madness::BoxSurfaceDisplacementRange::is_periodic</a></div><div class="ttdeci">const array_of_bools&lt; NDIM &gt; &amp; is_periodic() const</div><div class="ttdef"><b>Definition</b> displacements.h:699</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_adf24885c6210739a4044fd5206e2b0ee"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#adf24885c6210739a4044fd5206e2b0ee">madness::BoxSurfaceDisplacementRange::end</a></div><div class="ttdeci">auto end() const</div><div class="ttdoc">Returns an iterator to the end of the surface points.</div><div class="ttdef"><b>Definition</b> displacements.h:669</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_ae0d4fbcf82c2b46e2f76442269cdb439"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae0d4fbcf82c2b46e2f76442269cdb439">madness::BoxSurfaceDisplacementRange::PointPattern</a></div><div class="ttdeci">Vector&lt; std::optional&lt; Translation &gt;, NDIM &gt; PointPattern</div><div class="ttdef"><b>Definition</b> displacements.h:297</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_ae9704b369fbb4145eaf4a87330004300"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#ae9704b369fbb4145eaf4a87330004300">madness::BoxSurfaceDisplacementRange::Box</a></div><div class="ttdeci">std::array&lt; std::pair&lt; Translation, Translation &gt;, NDIM &gt; Box</div><div class="ttdef"><b>Definition</b> displacements.h:305</div></div>
<div class="ttc" id="aclassmadness_1_1BoxSurfaceDisplacementRange_html_afbf60ef5fe1d1e7b7d9bf004025d4392"><div class="ttname"><a href="classmadness_1_1BoxSurfaceDisplacementRange.html#afbf60ef5fe1d1e7b7d9bf004025d4392">madness::BoxSurfaceDisplacementRange::box_radius_</a></div><div class="ttdeci">BoxRadius box_radius_</div><div class="ttdoc">halved size of the box in each dimension</div><div class="ttdef"><b>Definition</b> displacements.h:310</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html"><div class="ttname"><a href="classmadness_1_1Displacements.html">madness::Displacements</a></div><div class="ttdoc">Holds displacements for applying operators to avoid replicating for all operators.</div><div class="ttdef"><b>Definition</b> displacements.h:51</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a1e764475c6497c143f77d918d80555f3"><div class="ttname"><a href="classmadness_1_1Displacements.html#a1e764475c6497c143f77d918d80555f3">madness::Displacements::disp</a></div><div class="ttdeci">static std::vector&lt; Key&lt; NDIM &gt; &gt; disp</div><div class="ttdoc">standard displacements to be used with standard kernels (range-unrestricted, no lattice sum)</div><div class="ttdef"><b>Definition</b> displacements.h:53</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a2756cf4821f39f10624ba267ec042a1d"><div class="ttname"><a href="classmadness_1_1Displacements.html#a2756cf4821f39f10624ba267ec042a1d">madness::Displacements::cmp_keys</a></div><div class="ttdeci">static bool cmp_keys(const Key&lt; NDIM &gt; &amp;a, const Key&lt; NDIM &gt; &amp;b)</div><div class="ttdef"><b>Definition</b> displacements.h:71</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a2e774ca7f8de28edc1763bc07ea00cf1"><div class="ttname"><a href="classmadness_1_1Displacements.html#a2e774ca7f8de28edc1763bc07ea00cf1">madness::Displacements::get_disp</a></div><div class="ttdeci">const std::vector&lt; Key&lt; NDIM &gt; &gt; &amp; get_disp()</div><div class="ttdoc">return the standard displacements appropriate for operators w/o lattice summation</div><div class="ttdef"><b>Definition</b> displacements.h:235</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a31a2302044cd8c5c2fe1f746fc24cf74"><div class="ttname"><a href="classmadness_1_1Displacements.html#a31a2302044cd8c5c2fe1f746fc24cf74">madness::Displacements::get_disp</a></div><div class="ttdeci">const std::vector&lt; Key&lt; NDIM &gt; &gt; &amp; get_disp(Level n, const array_of_bools&lt; NDIM &gt; &amp;kernel_lattice_sum_axes)</div><div class="ttdef"><b>Definition</b> displacements.h:211</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a51a620f934fb6a98fdb6bf5593a105cc"><div class="ttname"><a href="classmadness_1_1Displacements.html#a51a620f934fb6a98fdb6bf5593a105cc">madness::Displacements::periodic_axes</a></div><div class="ttdeci">static array_of_bools&lt; NDIM &gt; periodic_axes</div><div class="ttdoc">along which axes lattice summation is performed?</div><div class="ttdef"><b>Definition</b> displacements.h:54</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a581c99bfa05134a91e438c7b9e2633bd"><div class="ttname"><a href="classmadness_1_1Displacements.html#a581c99bfa05134a91e438c7b9e2633bd">madness::Displacements::reset_periodic_axes</a></div><div class="ttdeci">static void reset_periodic_axes(const array_of_bools&lt; NDIM &gt; &amp;new_periodic_axes)</div><div class="ttdoc">rebuilds periodic displacements so that they are optimal for the given set of periodic axes</div><div class="ttdef"><b>Definition</b> displacements.h:249</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a5d59442277b92cbfb2423b79bcc576b4"><div class="ttname"><a href="classmadness_1_1Displacements.html#a5d59442277b92cbfb2423b79bcc576b4">madness::Displacements::make_disp</a></div><div class="ttdeci">static void make_disp(int bmax)</div><div class="ttdef"><b>Definition</b> displacements.h:79</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a975f4002a5a404e79c25d7eeccbd9959"><div class="ttname"><a href="classmadness_1_1Displacements.html#a975f4002a5a404e79c25d7eeccbd9959">madness::Displacements::disp_periodic</a></div><div class="ttdeci">static std::vector&lt; Key&lt; NDIM &gt; &gt; disp_periodic[64]</div><div class="ttdoc">displacements to be used with lattice-summed kernels</div><div class="ttdef"><b>Definition</b> displacements.h:55</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_a9803d533f65eb7f3a3755af1ed5bbdca"><div class="ttname"><a href="classmadness_1_1Displacements.html#a9803d533f65eb7f3a3755af1ed5bbdca">madness::Displacements::make_disp_periodic</a></div><div class="ttdeci">static void make_disp_periodic(int bmax, Level n)</div><div class="ttdef"><b>Definition</b> displacements.h:135</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_aa0ea990f0768c70bef4516a7b9e1b970"><div class="ttname"><a href="classmadness_1_1Displacements.html#aa0ea990f0768c70bef4516a7b9e1b970">madness::Displacements::bmax_default</a></div><div class="ttdeci">static int bmax_default()</div><div class="ttdef"><b>Definition</b> displacements.h:58</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_acca9ca50075802eab9592e6d58863859"><div class="ttname"><a href="classmadness_1_1Displacements.html#acca9ca50075802eab9592e6d58863859">madness::Displacements::cmp_keys_periodic</a></div><div class="ttdeci">static bool cmp_keys_periodic(const Key&lt; NDIM &gt; &amp;a, const Key&lt; NDIM &gt; &amp;b)</div><div class="ttdef"><b>Definition</b> displacements.h:75</div></div>
<div class="ttc" id="aclassmadness_1_1Displacements_html_ae533d430ebd1daf7c014ba148cb846f9"><div class="ttname"><a href="classmadness_1_1Displacements.html#ae533d430ebd1daf7c014ba148cb846f9">madness::Displacements::Displacements</a></div><div class="ttdeci">Displacements()</div><div class="ttdef"><b>Definition</b> displacements.h:190</div></div>
<div class="ttc" id="aclassmadness_1_1FunctionDefaults_html"><div class="ttname"><a href="classmadness_1_1FunctionDefaults.html">madness::FunctionDefaults</a></div><div class="ttdoc">FunctionDefaults holds default paramaters as static class members.</div><div class="ttdef"><b>Definition</b> funcdefaults.h:100</div></div>
<div class="ttc" id="aclassmadness_1_1IndexIterator_html"><div class="ttname"><a href="classmadness_1_1IndexIterator.html">madness::IndexIterator</a></div><div class="ttdef"><b>Definition</b> indexit.h:55</div></div>
<div class="ttc" id="aclassmadness_1_1Key_html"><div class="ttname"><a href="classmadness_1_1Key.html">madness::Key</a></div><div class="ttdoc">Key is the index for a node of the 2^NDIM-tree.</div><div class="ttdef"><b>Definition</b> key.h:69</div></div>
<div class="ttc" id="aclassmadness_1_1Vector_html"><div class="ttname"><a href="classmadness_1_1Vector.html">madness::Vector</a></div><div class="ttdoc">A simple, fixed dimension vector.</div><div class="ttdef"><b>Definition</b> vector.h:64</div></div>
<div class="ttc" id="aclassmadness_1_1array__of__bools_html"><div class="ttname"><a href="classmadness_1_1array__of__bools.html">madness::array_of_bools</a></div><div class="ttdoc">syntactic sugar for std::array&lt;bool, N&gt;</div><div class="ttdef"><b>Definition</b> array_of_bools.h:19</div></div>
<div class="ttc" id="aclassmadness_1_1array__of__bools_html_a0678b3aefb6c7ea0c88042f8a269eb28"><div class="ttname"><a href="classmadness_1_1array__of__bools.html#a0678b3aefb6c7ea0c88042f8a269eb28">madness::array_of_bools::any</a></div><div class="ttdeci">bool any() const</div><div class="ttdef"><b>Definition</b> array_of_bools.h:38</div></div>
<div class="ttc" id="aderivatives_8cc_html_a838a54fc0838a6e7dcf1b1672df50158"><div class="ttname"><a href="derivatives_8cc.html#a838a54fc0838a6e7dcf1b1672df50158">p</a></div><div class="ttdeci">char * p(char *buf, const char *name, int k, int initial_level, double thresh, int order)</div><div class="ttdef"><b>Definition</b> derivatives.cc:72</div></div>
<div class="ttc" id="adirac-hatom_8cc_html_a5d2bc9cf5cb31f48733d683b47e7a10a"><div class="ttname"><a href="dirac-hatom_8cc.html#a5d2bc9cf5cb31f48733d683b47e7a10a">mask</a></div><div class="ttdeci">real_function_3d mask</div><div class="ttdef"><b>Definition</b> dirac-hatom.cc:27</div></div>
<div class="ttc" id="afuncdefaults_8h_html"><div class="ttname"><a href="funcdefaults_8h.html">funcdefaults.h</a></div><div class="ttdoc">Provides FunctionDefaults and utilities for coordinate transformation.</div></div>
<div class="ttc" id="aindexit_8h_html"><div class="ttname"><a href="indexit_8h.html">indexit.h</a></div><div class="ttdoc">Provides IndexIterator.</div></div>
<div class="ttc" id="amadness__config_8h_html_ae7e09bfb2f7ac068b0a14ac313a3178f"><div class="ttname"><a href="madness__config_8h.html#ae7e09bfb2f7ac068b0a14ac313a3178f">MADNESS_PRAGMA_CLANG</a></div><div class="ttdeci">#define MADNESS_PRAGMA_CLANG(x)</div><div class="ttdef"><b>Definition</b> madness_config.h:200</div></div>
<div class="ttc" id="amadness__exception_8h_html_a629efc935073cf10318bc5bf759ad8f3"><div class="ttname"><a href="madness__exception_8h.html#a629efc935073cf10318bc5bf759ad8f3">MADNESS_EXCEPTION</a></div><div class="ttdeci">#define MADNESS_EXCEPTION(msg, value)</div><div class="ttdoc">Macro for throwing a MADNESS exception.</div><div class="ttdef"><b>Definition</b> madness_exception.h:119</div></div>
<div class="ttc" id="amadness__exception_8h_html_ae80fa540b62afc0e301296b3102ec106"><div class="ttname"><a href="madness__exception_8h.html#ae80fa540b62afc0e301296b3102ec106">MADNESS_ASSERT</a></div><div class="ttdeci">#define MADNESS_ASSERT(condition)</div><div class="ttdoc">Assert a condition that should be free of side-effects since in release builds this might be a no-op.</div><div class="ttdef"><b>Definition</b> madness_exception.h:134</div></div>
<div class="ttc" id="anamespacemadness_html"><div class="ttname"><a href="namespacemadness.html">madness</a></div><div class="ttdoc">Namespace for all elements and tools of MADNESS.</div><div class="ttdef"><b>Definition</b> DFParameters.h:10</div></div>
<div class="ttc" id="anamespacemadness_html_a5f13039cd0622068354632e1cd30bef5"><div class="ttname"><a href="namespacemadness.html#a5f13039cd0622068354632e1cd30bef5">madness::Translation</a></div><div class="ttdeci">int64_t Translation</div><div class="ttdef"><b>Definition</b> key.h:57</div></div>
<div class="ttc" id="anamespacemadness_html_a5f57de63fed811496233d87e235d430a"><div class="ttname"><a href="namespacemadness.html#a5f57de63fed811496233d87e235d430a">madness::displacement</a></div><div class="ttdeci">Key&lt; NDIM &gt; displacement(const Key&lt; NDIM &gt; &amp;source, const Key&lt; NDIM &gt; &amp;target)</div><div class="ttdoc">given a source and a target, return the displacement in translation</div><div class="ttdef"><b>Definition</b> key.h:451</div></div>
<div class="ttc" id="anamespacemadness_html_a7aaa6b2a2b22030331158b0d1156641f"><div class="ttname"><a href="namespacemadness.html#a7aaa6b2a2b22030331158b0d1156641f">madness::Level</a></div><div class="ttdeci">int Level</div><div class="ttdef"><b>Definition</b> key.h:58</div></div>
<div class="ttc" id="anamespacemadness_html_a8fbd6434ef0ac76d2fc0b586d28b49fa"><div class="ttname"><a href="namespacemadness.html#a8fbd6434ef0ac76d2fc0b586d28b49fa">madness::pop</a></div><div class="ttdeci">static double pop(std::vector&lt; double &gt; &amp;v)</div><div class="ttdef"><b>Definition</b> SCF.cc:113</div></div>
<div class="ttc" id="anamespacemadness_html_abd36a25686e60712d4bb7c2714a9aeaf"><div class="ttname"><a href="namespacemadness.html#abd36a25686e60712d4bb7c2714a9aeaf">madness::iota_array</a></div><div class="ttdeci">constexpr std::array&lt; std::size_t, N-M &gt; iota_array(std::array&lt; std::size_t, M &gt; values_to_skip_sorted)</div><div class="ttdef"><b>Definition</b> displacements.h:266</div></div>
<div class="ttc" id="anamespacemadness_html_ac04610aea88b4041699b7315bbe4dce2"><div class="ttname"><a href="namespacemadness.html#ac04610aea88b4041699b7315bbe4dce2">madness::type</a></div><div class="ttdeci">std::string type(const PairType &amp;n)</div><div class="ttdef"><b>Definition</b> PNOParameters.h:18</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition</b> mraimpl.h:50</div></div>
<div class="ttc" id="anamespacestd_html_abd13c8061bb606bae54f873cf31bf559"><div class="ttname"><a href="namespacestd.html#abd13c8061bb606bae54f873cf31bf559">std::abs</a></div><div class="ttdeci">static long abs(long a)</div><div class="ttdef"><b>Definition</b> tensor.h:218</div></div>
<div class="ttc" id="anonlinschro_8cc_html_a8f5a312161775190357a664a77a831a3"><div class="ttname"><a href="nonlinschro_8cc.html#a8f5a312161775190357a664a77a831a3">b</a></div><div class="ttdeci">static const double b</div><div class="ttdef"><b>Definition</b> nonlinschro.cc:119</div></div>
<div class="ttc" id="anonlinschro_8cc_html_a9b9696f53f99dc4d5ef66af0428e3782"><div class="ttname"><a href="nonlinschro_8cc.html#a9b9696f53f99dc4d5ef66af0428e3782">d</a></div><div class="ttdeci">static const double d</div><div class="ttdef"><b>Definition</b> nonlinschro.cc:121</div></div>
<div class="ttc" id="anonlinschro_8cc_html_ab725778fe3179d0229a8da4c908bdf61"><div class="ttname"><a href="nonlinschro_8cc.html#ab725778fe3179d0229a8da4c908bdf61">a</a></div><div class="ttdeci">static const double a</div><div class="ttdef"><b>Definition</b> nonlinschro.cc:118</div></div>
<div class="ttc" id="atestconv_8cc_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="testconv_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdef"><b>Definition</b> testconv.cc:37</div></div>
<div class="ttc" id="atestgconv_8cc_html_a21ba1978e7f857e6261dad8fc7e4d971"><div class="ttname"><a href="testgconv_8cc.html#a21ba1978e7f857e6261dad8fc7e4d971">NDIM</a></div><div class="ttdeci">constexpr std::size_t NDIM</div><div class="ttdef"><b>Definition</b> testgconv.cc:54</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 19 2025 19:00:47 for MADNESS by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
